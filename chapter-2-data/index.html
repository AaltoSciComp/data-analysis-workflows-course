

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 2: Data preparation &mdash; Data analysis workflows with R and Python  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mystnb.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script src="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
        <script src="../_static/sphinx_tabs/tabs.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Chapter 3: Modeling" href="../chapter-3-modeling/" />
    <link rel="prev" title="Chapter 1: Understanding data analysis workflows" href="../chapter-1-understanding/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../" class="icon icon-home" alt="Documentation Home"> Data analysis workflows with R and Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course lessons</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chapter-1-understanding/">Chapter 1: Understanding data analysis workflows</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 2: Data preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tidy-data">Tidy data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-data-operations">Simple data operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-data-from-csvs">Loading data from CSVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-and-removing-columns">Creating and removing columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#turning-input-processing-tasks-into-functions">Turning input processing tasks into functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#categorical-data-format">Categorical data format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-datasets-together">Joining datasets together</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demonstrating-atp-dataset-longest-reign-at-rank-1">Demonstrating ATP dataset: Longest reign at rank 1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-binary-data-formats-to-improve-your-pipeline">Using binary data formats to improve your pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-binary-data-formats">Why binary data formats?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csvs">CSVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialized-objects">Serialized objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feather">Feather</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parquet">Parquet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hdf5">HDF5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-data-formats-sizes">Binary data formats’ sizes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-data-formats">Other data formats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#excel-spreadsheets">Excel spreadsheets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sql-databases">SQL databases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-3-modeling/">Chapter 3: Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-4-scaling/">Chapter 4: Scaling</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Data analysis workflows with R and Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
        
      <li>Chapter 2: Data preparation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/AaltoSciComp/data-analysis-workflows-course/blob/master/lectures/chapter-2-data.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-2-data-preparation">
<h1>Chapter 2: Data preparation<a class="headerlink" href="#chapter-2-data-preparation" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Commands run on this chapter are present in the
<code class="docutils literal notranslate"><span class="pre">X_exercises/ch2-X-lecture.ipynb</span></code>, where <code class="docutils literal notranslate"><span class="pre">X</span></code> is the programming
language.</p>
</div>
<div class="section" id="tidy-data">
<h2>Tidy data<a class="headerlink" href="#tidy-data" title="Permalink to this headline">¶</a></h2>
<p>Both R (<code class="docutils literal notranslate"><span class="pre">data.frame</span></code> and <code class="docutils literal notranslate"><span class="pre">tibble</span></code>) and pandas (<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>) store the
data as columnar vectors. They are in a so-called column-oriented format.</p>
<img alt="../_images/dataframe.svg" src="../_images/dataframe.svg" /><p>When the data is organized in a way where each column corresponds to a
variable and each row corresponds to a observation, we consider the dataset
<strong>tidy</strong>.</p>
<p>This image from Hadley Wickham’s excellent book
<a class="reference external" href="https://r4ds.had.co.nz/">R for Data Science</a> visualizes the idea:</p>
<img alt="https://raw.githubusercontent.com/hadley/r4ds/master/images/tidy-1.png" src="https://raw.githubusercontent.com/hadley/r4ds/master/images/tidy-1.png" />
<p>The name “tidy data” comes from Wickham’s
<a class="reference external" href="https://vita.had.co.nz/papers/tidy-data.pdf">paper (2014)</a>, that describes
the ideas in great detail.</p>
<p>The choice of this data format is by no means a one man show: in fact Wickham
cites Wes McKinney’s
<a class="reference external" href="http://conference.scipy.org/proceedings/scipy2010/pdfs/mckinney.pdf">paper (2010)</a>
on Pandas’ chosen data format as an example of a tidy data format. In fact both
<a class="reference external" href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">R</a>
and <a class="reference external" href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">Pandas</a> developers
recommend using tidy data.</p>
<p>Main reasons why this data format is recommended are:</p>
<ol class="arabic simple">
<li><p>It is easy to understand and helps to internalize how your data is
organized.</p></li>
<li><p>In tidy data format all observations in a variable have the same data
type. This means that columns can be stored as vectors. This saves memory
and allows for vectorized calculations that are much faster.</p></li>
<li><p>It is easy for developers to create methods as they can assume how the data
is organized.</p></li>
</ol>
<p>There are cases where tidy data might not be the optimal format. For example, if
your problem has matrices, you would not want to store it as rows and columns,
but as a two-dimensional array. Another situation might arise when your data is
in some other binary format e.g. image data. But in these cases you might
want to use tidy data to store e.g. image names or model parameters.</p>
<p>In this course our data is mostly in tidy format and if it’s not in that
format, we’ll want to convert our raw data into it as soon as possible.</p>
<div class="admonition-parsing-premiere-league-games-problem-1 challenge admonition">
<p class="admonition-title">Parsing Premiere League games - Problem 1</p>
<p>The exercise is provided in <code class="docutils literal notranslate"><span class="pre">X_exercises/ch2-X-ex1.ipynb</span></code>.</p>
<p>In the exercise we’ll create input parsing functions for
<a class="reference external" href="https://github.com/footballcsv/england">Premier League results</a>.</p>
<ul class="simple">
<li><p>Look at the one of the
<code class="docutils literal notranslate"><span class="pre">./data/england-master/XXXXs/XXXX-XX/eng.1.csv</span></code>-datasets.</p></li>
<li><p>Determine whether the data is in a tidy format.</p></li>
<li><p>If not, how would you modify the data format?</p></li>
</ul>
</div>
</div>
<div class="section" id="simple-data-operations">
<h2>Simple data operations<a class="headerlink" href="#simple-data-operations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loading-data-from-csvs">
<h3>Loading data from CSVs<a class="headerlink" href="#loading-data-from-csvs" title="Permalink to this headline">¶</a></h3>
<p>Let’s start with loading data in the most common data format: csv. Quite often
datasets are provided in this format because it is human readable and easy to
transfer among systems.</p>
<p>Let’s consider a <code class="docutils literal notranslate"><span class="pre">atp_players.csv</span></code>-dataset that contains ATP ranks of men’s
singles tennis players.</p>
<p>Let’s load the data with the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>-function:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">pandas.read_csv</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/atp_players.csv&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">,</span> <span class="s1">&#39;birth_date&#39;</span><span class="p">,</span> <span class="s1">&#39;country_code&#39;</span><span class="p">])</span>
<span class="n">atp_players</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
        <span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="mi">0</span>       <span class="mi">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="mf">19131122.0</span>      <span class="n">USA</span>
<span class="mi">1</span>       <span class="mi">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="mf">19210620.0</span>      <span class="n">ECU</span>
<span class="mi">2</span>       <span class="mi">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="mf">19271002.0</span>      <span class="n">AUS</span>
<span class="mi">3</span>       <span class="mi">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="mf">19271011.0</span>      <span class="n">ITA</span>
<span class="mi">4</span>       <span class="mi">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="mf">19280509.0</span>      <span class="n">USA</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<p><a class="reference external" href="https://readr.tidyverse.org/reference/read_delim.html">Tidyverse read_csv</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="s">&#39;../data/atp_players.csv&#39;</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;player_id&#39;</span><span class="p">,</span> <span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="s">&#39;hand&#39;</span><span class="p">,</span> <span class="s">&#39;birth_date&#39;</span><span class="p">,</span> <span class="s">&#39;country_code&#39;</span><span class="p">))</span>
<span class="n">Parsed</span> <span class="n">with</span> <span class="n">column</span> <span class="n">specification</span><span class="o">:</span>
<span class="nf">cols</span><span class="p">(</span>
  <span class="n">player_id</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">first_name</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">last_name</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">hand</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">birth_date</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">country_code</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="m">19131122</span>        <span class="n">USA</span>
<span class="m">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="m">19210620</span>        <span class="n">ECU</span>
<span class="m">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="m">19271002</span>        <span class="n">AUS</span>
<span class="m">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="m">19271011</span>        <span class="n">ITA</span>
<span class="m">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="m">19280509</span>        <span class="n">USA</span>
<span class="m">100006</span>  <span class="n">Grant</span>   <span class="n">Golden</span>  <span class="n">R</span>       <span class="m">19290821</span>        <span class="n">USA</span>
</pre></div>
</div>
</div>
</div>
<p>This function not only parses the text, but also tries to convert the columns
to a best possible fata types. To check column data types, use:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-1-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-1-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="n">player_id</span>         <span class="n">int64</span>
<span class="n">first_name</span>       <span class="nb">object</span>
<span class="n">last_name</span>        <span class="nb">object</span>
<span class="n">hand</span>             <span class="nb">object</span>
<span class="n">birth_date</span>      <span class="n">float64</span>
<span class="n">country_code</span>     <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">Classes</span> ‘<span class="n">spec_tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>        <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">6</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">first_name</span>  <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Gardnar&quot;</span> <span class="s">&quot;Pancho&quot;</span> <span class="s">&quot;Frank&quot;</span> <span class="s">&quot;Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">last_name</span>   <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy&quot;</span> <span class="s">&quot;Segura&quot;</span> <span class="s">&quot;Sedgman&quot;</span> <span class="s">&quot;Merlo&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">num</span>  <span class="m">19131122</span> <span class="m">19210620</span> <span class="m">19271002</span> <span class="m">19271011</span> <span class="m">19280509</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;USA&quot;</span> <span class="s">&quot;ECU&quot;</span> <span class="s">&quot;AUS&quot;</span> <span class="s">&quot;ITA&quot;</span> <span class="kc">...</span>
 <span class="o">-</span> <span class="nf">attr</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s">&quot;spec&quot;</span><span class="p">)</span><span class="o">=</span>
  <span class="n">..</span> <span class="nf">cols</span><span class="p">(</span>
  <span class="n">..</span>   <span class="n">player_id</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">..</span>   <span class="n">first_name</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">..</span>   <span class="n">last_name</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">..</span>   <span class="n">hand</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">..</span>   <span class="n">birth_date</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">..</span>   <span class="n">country_code</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">()</span>
  <span class="n">..</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">head</span></code>-function can be used to show the first few rows of our dataset.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-2-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-2-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="mi">0</span>       <span class="mi">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="mf">19131122.0</span>      <span class="n">USA</span>
<span class="mi">1</span>       <span class="mi">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="mf">19210620.0</span>      <span class="n">ECU</span>
<span class="mi">2</span>       <span class="mi">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="mf">19271002.0</span>      <span class="n">AUS</span>
<span class="mi">3</span>       <span class="mi">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="mf">19271011.0</span>      <span class="n">ITA</span>
<span class="mi">4</span>       <span class="mi">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="mf">19280509.0</span>      <span class="n">USA</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="m">19131122</span>        <span class="n">USA</span>
<span class="m">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="m">19210620</span>        <span class="n">ECU</span>
<span class="m">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="m">19271002</span>        <span class="n">AUS</span>
<span class="m">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="m">19271011</span>        <span class="n">ITA</span>
<span class="m">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="m">19280509</span>        <span class="n">USA</span>
<span class="m">100006</span>  <span class="n">Grant</span>   <span class="n">Golden</span>  <span class="n">R</span>       <span class="m">19290821</span>        <span class="n">USA</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-and-removing-columns">
<h3>Creating and removing columns<a class="headerlink" href="#creating-and-removing-columns" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by converting the birth date column into an actual time stamp.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-3-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-3-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html">pandas.to_datetime</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_players</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

<span class="n">player_id</span>                <span class="n">int64</span>
<span class="n">first_name</span>              <span class="nb">object</span>
<span class="n">last_name</span>               <span class="nb">object</span>
<span class="n">hand</span>                    <span class="nb">object</span>
<span class="n">birth_date</span>      <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">country_code</span>            <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/mutate.html">Tidyverse mutate</a></p>
<p><a class="reference external" href="https://lubridate.tidyverse.org/reference/parse_date_time.html">Lubridate parse_date_time</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="n">atp_players</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">birth_date</span><span class="o">=</span><span class="nf">parse_date_time</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;%Y%m%d&#39;</span><span class="p">))</span>
<span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">Warning</span> <span class="n">message</span><span class="o">:</span>
“ <span class="m">125</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">parse.</span>”

<span class="n">Classes</span> ‘<span class="n">spec_tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>        <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">6</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">first_name</span>  <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Gardnar&quot;</span> <span class="s">&quot;Pancho&quot;</span> <span class="s">&quot;Frank&quot;</span> <span class="s">&quot;Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">last_name</span>   <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy&quot;</span> <span class="s">&quot;Segura&quot;</span> <span class="s">&quot;Sedgman&quot;</span> <span class="s">&quot;Merlo&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">POSIXct</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">&quot;1913-11-22&quot;</span> <span class="s">&quot;1921-06-20&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;USA&quot;</span> <span class="s">&quot;ECU&quot;</span> <span class="s">&quot;AUS&quot;</span> <span class="s">&quot;ITA&quot;</span> <span class="kc">...</span>
</pre></div>
</div>
</div>
</div>
<p>In our current situation we have separate columns for first and last names.
Let’s join these columns into one column called <code class="docutils literal notranslate"><span class="pre">name</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-4-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-4-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span>

<span class="n">atp_players</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="mf">19131122.0</span>      <span class="n">USA</span>     <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>
<span class="mi">1</span>       <span class="mi">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="mf">19210620.0</span>      <span class="n">ECU</span>     <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>
<span class="mi">2</span>       <span class="mi">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="mf">19271002.0</span>      <span class="n">AUS</span>     <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>
<span class="mi">3</span>       <span class="mi">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="mf">19271011.0</span>      <span class="n">ITA</span>     <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>
<span class="mi">4</span>       <span class="mi">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="mf">19280509.0</span>      <span class="n">USA</span>     <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-1 docutils container">
<p><a class="reference external" href="https://tidyr.tidyverse.org/reference/unite.html">Tidyverse unite</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="n">atp_players</span> <span class="o">%&gt;%</span>
    <span class="nf">unite</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">player_id</span>       <span class="n">name</span>    <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">100001</span>  <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>         <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="m">19131122</span>        <span class="n">USA</span>
<span class="m">100002</span>  <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="m">19210620</span>        <span class="n">ECU</span>
<span class="m">100003</span>  <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="m">19271002</span>        <span class="n">AUS</span>
<span class="m">100004</span>  <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>         <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="m">19271011</span>        <span class="n">ITA</span>
<span class="m">100005</span>  <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span>        <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="m">19280509</span>        <span class="n">USA</span>
<span class="m">100006</span>  <span class="n">Golden</span><span class="p">,</span> <span class="n">Grant</span>   <span class="n">Grant</span>   <span class="n">Golden</span>  <span class="n">R</span>       <span class="m">19290821</span>        <span class="n">USA</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can drop our unneeded columns:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-5-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-5-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-5-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html">pandas.DataFrame.drop</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span><span class="s1">&#39;last_name&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">atp_players</span><span class="o">.</span><span class="n">dtypes</span>

<span class="n">player_id</span>         <span class="n">int64</span>
<span class="n">hand</span>             <span class="nb">object</span>
<span class="n">birth_date</span>      <span class="n">float64</span>
<span class="n">country_code</span>     <span class="nb">object</span>
<span class="n">name</span>             <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-5-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/select.html">Tidyverse select</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="n">atp_players</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">first_name</span><span class="p">,</span> <span class="o">-</span><span class="n">last_name</span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">Classes</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>       <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">5</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">name</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy, Gardnar&quot;</span> <span class="s">&quot;Segura, Pancho&quot;</span> <span class="s">&quot;Sedgman, Frank&quot;</span> <span class="s">&quot;Merlo, Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">num</span>  <span class="m">19131122</span> <span class="m">19210620</span> <span class="m">19271002</span> <span class="m">19271011</span> <span class="m">19280509</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;USA&quot;</span> <span class="s">&quot;ECU&quot;</span> <span class="s">&quot;AUS&quot;</span> <span class="s">&quot;ITA&quot;</span> <span class="kc">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="turning-input-processing-tasks-into-functions">
<h3>Turning input processing tasks into functions<a class="headerlink" href="#turning-input-processing-tasks-into-functions" title="Permalink to this headline">¶</a></h3>
<p>Now that we have an idea what operations we want to accomplish for our data
loading, we should codify these operations by creating a data loading function.</p>
<p>Let’s create a data loading function for loading ATP player data:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-6-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-6-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-6-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_atp_players</span><span class="p">(</span><span class="n">atp_players_file</span><span class="p">):</span>
    <span class="n">atp_players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atp_players_file</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">,</span> <span class="s1">&#39;birth_date&#39;</span><span class="p">,</span> <span class="s1">&#39;country_code&#39;</span><span class="p">])</span>
    <span class="n">atp_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">atp_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;birth_date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">atp_players</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atp_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;last_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">atp_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span>
    <span class="n">atp_players</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span><span class="s1">&#39;last_name&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">atp_players</span>

<span class="n">atp_players</span> <span class="o">=</span> <span class="n">load_atp_players</span><span class="p">(</span><span class="s1">&#39;../data/atp_players.csv&#39;</span><span class="p">)</span>
<span class="n">atp_players</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">player_id</span>       <span class="n">first_name</span>      <span class="n">last_name</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">100001</span>  <span class="n">Gardnar</span>         <span class="n">Mulloy</span>  <span class="n">R</span>       <span class="mi">1913</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">22</span>      <span class="n">USA</span>     <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>
<span class="mi">1</span>       <span class="mi">100002</span>  <span class="n">Pancho</span>  <span class="n">Segura</span>  <span class="n">R</span>       <span class="mi">1921</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">20</span>      <span class="n">ECU</span>     <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>
<span class="mi">2</span>       <span class="mi">100003</span>  <span class="n">Frank</span>   <span class="n">Sedgman</span>         <span class="n">R</span>       <span class="mi">1927</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>      <span class="n">AUS</span>     <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>
<span class="mi">3</span>       <span class="mi">100004</span>  <span class="n">Giuseppe</span>        <span class="n">Merlo</span>   <span class="n">R</span>       <span class="mi">1927</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span>      <span class="n">ITA</span>     <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>
<span class="mi">4</span>       <span class="mi">100005</span>  <span class="n">Richard</span> <span class="n">Pancho</span>  <span class="n">Gonzales</span>        <span class="n">R</span>       <span class="mi">1928</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span>      <span class="n">USA</span>     <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-6-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">load_atp_players</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">atp_players_file</span><span class="p">){</span>
    <span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">atp_players_file</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;player_id&#39;</span><span class="p">,</span> <span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="s">&#39;hand&#39;</span><span class="p">,</span> <span class="s">&#39;birth_date&#39;</span><span class="p">,</span> <span class="s">&#39;country_code&#39;</span><span class="p">),</span> <span class="n">col_types</span><span class="o">=</span><span class="nf">cols</span><span class="p">())</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate</span><span class="p">(</span><span class="n">birth_date</span><span class="o">=</span><span class="nf">parse_date_time</span><span class="p">(</span><span class="n">birth_date</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;%Y%m%d&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="nf">unite</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate_at</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;country_code&#39;</span><span class="p">,</span> <span class="s">&#39;hand&#39;</span><span class="p">),</span> <span class="n">as.factor</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="nf">load_atp_players</span><span class="p">(</span><span class="s">&#39;../data/atp_players.csv&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">Warning</span> <span class="n">message</span><span class="o">:</span>
“ <span class="m">125</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">parse.</span>”

<span class="n">player_id</span>       <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">100001</span>  <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>         <span class="n">R</span>       <span class="m">1913-11-22</span>      <span class="n">USA</span>
<span class="m">100002</span>  <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>  <span class="n">R</span>       <span class="m">1921-06-20</span>      <span class="n">ECU</span>
<span class="m">100003</span>  <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>  <span class="n">R</span>       <span class="m">1927-10-02</span>      <span class="n">AUS</span>
<span class="m">100004</span>  <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>         <span class="n">R</span>       <span class="m">1927-10-11</span>      <span class="n">ITA</span>
<span class="m">100005</span>  <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span>        <span class="n">R</span>       <span class="m">1928-05-09</span>      <span class="n">USA</span>
<span class="m">100006</span>  <span class="n">Golden</span><span class="p">,</span> <span class="n">Grant</span>   <span class="n">R</span>       <span class="m">1929-08-21</span>      <span class="n">USA</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-parsing-premiere-league-games-problem-2 challenge admonition">
<p class="admonition-title">Parsing Premiere League games - Problem 2</p>
<p>The exercise is provided in <code class="docutils literal notranslate"><span class="pre">X_exercises/ch2-X-ex1.ipynb</span></code>.</p>
<p>In this exercise we’ll create input parsing functions for
<a class="reference external" href="https://github.com/footballcsv/england">Premier League results</a>.</p>
<ul class="simple">
<li><p>Create a function that loads the match data, converts date
into a proper date object and determines the season from
the date.</p></li>
</ul>
</div>
</div>
<div class="section" id="categorical-data-format">
<h3>Categorical data format<a class="headerlink" href="#categorical-data-format" title="Permalink to this headline">¶</a></h3>
<p>When working with string data that has well defined categories, it is usually a
good idea to convert the data into categorical (Python) / factor (R) format.
In this format all unique strings are given an integer value and the string
array is converted into an integer array with this mapping. The unique strings
are called “categories” or “levels” of the categorical/factor array.</p>
<p>Main benefits of using categorical data are:</p>
<ul class="simple">
<li><p>Makes it easier to re-categorize the data by combining levels.</p></li>
<li><p>Helps with grouping and plot labeling.</p></li>
<li><p>Reduced memory consumption.</p></li>
</ul>
<p>Disadvantages include:</p>
<ul class="simple">
<li><p>For string arrays with completely unique values (e.g. our <code class="docutils literal notranslate"><span class="pre">name</span></code>-column),
most of the benefits are lost.</p></li>
<li><p>Some models may recognize categorical data as numeric data as the underlying
format in memory is an integer array. Check documentation of your modeling
function whether it works with categorical data.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-7-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-7-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-7-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html">Pandas categorical</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html">Pandas apply</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_players_categorized</span> <span class="o">=</span> <span class="n">atp_players</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_players_categorized</span><span class="p">[</span><span class="s1">&#39;hand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nbytes</span><span class="p">)</span>
<span class="n">atp_players_categorized</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">atp_players_categorized</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_players_categorized</span><span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nbytes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_players_categorized</span><span class="p">[</span><span class="s1">&#39;hand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
<span class="n">atp_players_categorized</span><span class="o">.</span><span class="n">dtypes</span>

<span class="mi">54970</span>
<span class="mi">111556</span>
<span class="n">Index</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>

<span class="n">player_id</span>                <span class="n">int64</span>
<span class="n">hand</span>                  <span class="n">category</span>
<span class="n">birth_date</span>      <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">country_code</span>          <span class="n">category</span>
<span class="n">name</span>                    <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-7-1 docutils container">
<p><a class="reference external" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor">R factor</a></p>
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/mutate_all.html">Tidyverse mutate_at</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">object.size</span><span class="p">(</span><span class="n">atp_players</span><span class="p">[[</span><span class="s">&#39;hand&#39;</span><span class="p">]])</span>
<span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="n">atp_players</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate_at</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;country_code&#39;</span><span class="p">,</span> <span class="s">&#39;hand&#39;</span><span class="p">),</span> <span class="n">as.factor</span><span class="p">)</span>
<span class="nf">object.size</span><span class="p">(</span><span class="n">atp_players</span><span class="p">[[</span><span class="s">&#39;hand&#39;</span><span class="p">]])</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">atp_players</span><span class="p">[[</span><span class="s">&#39;hand&#39;</span><span class="p">]]))</span>
<span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="m">439776</span> <span class="n">bytes</span>
<span class="m">220440</span> <span class="n">bytes</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;A&quot;</span> <span class="s">&quot;L&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;U&quot;</span>
<span class="n">Classes</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>       <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">5</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">name</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy, Gardnar&quot;</span> <span class="s">&quot;Segura, Pancho&quot;</span> <span class="s">&quot;Sedgman, Frank&quot;</span> <span class="s">&quot;Merlo, Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">4</span> <span class="n">levels</span> <span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;L&quot;</span><span class="p">,</span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="s">&quot;U&quot;</span><span class="o">:</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">2</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">num</span>  <span class="m">19131122</span> <span class="m">19210620</span> <span class="m">19271002</span> <span class="m">19271011</span> <span class="m">19280509</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">210</span> <span class="n">levels</span> <span class="s">&quot;AFG&quot;</span><span class="p">,</span><span class="s">&quot;AHO&quot;</span><span class="p">,</span><span class="s">&quot;ALB&quot;</span><span class="p">,</span><span class="n">..</span><span class="o">:</span> <span class="m">200</span> <span class="m">62</span> <span class="m">13</span> <span class="m">97</span> <span class="m">200</span> <span class="m">200</span> <span class="m">160</span> <span class="m">58</span> <span class="m">88</span> <span class="m">43</span> <span class="kc">...</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create a function for this behaviour as well:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-8-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-8-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-8-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_players</span><span class="p">(</span><span class="n">players</span><span class="p">):</span>
    <span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;hand&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">players</span>

<span class="nb">print</span><span class="p">(</span><span class="n">atp_players</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="n">atp_players</span> <span class="o">=</span> <span class="n">categorize_players</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>
<span class="n">atp_players</span><span class="o">.</span><span class="n">dtypes</span>

<span class="n">player_id</span>                <span class="n">int64</span>
<span class="n">hand</span>                    <span class="nb">object</span>
<span class="n">birth_date</span>      <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">country_code</span>            <span class="nb">object</span>
<span class="n">name</span>                    <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">player_id</span>                <span class="n">int64</span>
<span class="n">hand</span>                  <span class="n">category</span>
<span class="n">birth_date</span>      <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">country_code</span>          <span class="n">category</span>
<span class="n">name</span>                    <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-8-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">categorize_players</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">players</span> <span class="o">&lt;-</span> <span class="n">players</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate_at</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;country_code&#39;</span><span class="p">,</span> <span class="s">&#39;hand&#39;</span><span class="p">),</span> <span class="n">as.factor</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>
<span class="n">atp_players</span> <span class="o">&lt;-</span> <span class="nf">categorize_players</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">atp_players</span><span class="p">)</span>

<span class="n">Classes</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>       <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">5</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">name</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy, Gardnar&quot;</span> <span class="s">&quot;Segura, Pancho&quot;</span> <span class="s">&quot;Sedgman, Frank&quot;</span> <span class="s">&quot;Merlo, Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="s">&quot;R&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">POSIXct</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">&quot;1913-11-22&quot;</span> <span class="s">&quot;1921-06-20&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;USA&quot;</span> <span class="s">&quot;ECU&quot;</span> <span class="s">&quot;AUS&quot;</span> <span class="s">&quot;ITA&quot;</span> <span class="kc">...</span>
<span class="n">Classes</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>       <span class="m">54938</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">5</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="m">1e+05</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">name</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Mulloy, Gardnar&quot;</span> <span class="s">&quot;Segura, Pancho&quot;</span> <span class="s">&quot;Sedgman, Frank&quot;</span> <span class="s">&quot;Merlo, Giuseppe&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">4</span> <span class="n">levels</span> <span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;L&quot;</span><span class="p">,</span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="s">&quot;U&quot;</span><span class="o">:</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">2</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">POSIXct</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">&quot;1913-11-22&quot;</span> <span class="s">&quot;1921-06-20&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">210</span> <span class="n">levels</span> <span class="s">&quot;AFG&quot;</span><span class="p">,</span><span class="s">&quot;AHO&quot;</span><span class="p">,</span><span class="s">&quot;ALB&quot;</span><span class="p">,</span><span class="n">..</span><span class="o">:</span> <span class="m">200</span> <span class="m">62</span> <span class="m">13</span> <span class="m">97</span> <span class="m">200</span> <span class="m">200</span> <span class="m">160</span> <span class="m">58</span> <span class="m">88</span> <span class="m">43</span> <span class="kc">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="joining-datasets-together">
<h3>Joining datasets together<a class="headerlink" href="#joining-datasets-together" title="Permalink to this headline">¶</a></h3>
<p>Quite often the data one obtains is not in a single file, but spread across
multiple files. In situations like these you’ll need to combine these datasets.
However, there are different ways to combine datasets:</p>
<ol class="arabic simple">
<li><p>Concatenation / adding rows. In concatenation one dataset, with a certain
column format, is combined with another dataset with the same column format.
<strong>This process is usually slow</strong> because adding rows requires allocation of
new column vectors. Thus one should avoid these operations beyond the
initial data creation.</p></li>
<li><p>Joining / adding columns. During joining process columns from a dataset
with a certain column format are added into another dataset with a different
column format. When joining, it is important that the datasets have a some
common column (or an index) that can be used to match different
rows/observations. <strong>This process is usually fast</strong>, but one should always
determine the correct type of join type (left, right, union, full) to avoid
unnecessary NA-values. With large datasets (or databases) one should also
always first select the areas of interest and join those, not the other way
around.</p></li>
</ol>
<p>Let’s consider the data files <code class="docutils literal notranslate"><span class="pre">atp_rankings_00s.csv</span></code> and
<code class="docutils literal notranslate"><span class="pre">atp_rankings_10s.csv</span></code> that contain the weekly ATP rankings from the
2000s and 2010s. Let’s load these datasets:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-9-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-9-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-9-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_atp_rankings</span><span class="p">(</span><span class="n">atp_rankings_file</span><span class="p">):</span>
    <span class="n">atp_rankings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atp_rankings_file</span><span class="p">)</span>
    <span class="n">atp_rankings</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ranking_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">atp_rankings</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;ranking_date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">atp_rankings</span>

<span class="n">atp_rankings00</span> <span class="o">=</span> <span class="n">load_atp_rankings</span><span class="p">(</span><span class="s1">&#39;../data/atp_rankings_00s.csv&#39;</span><span class="p">)</span>
<span class="n">atp_rankings10</span> <span class="o">=</span> <span class="n">load_atp_rankings</span><span class="p">(</span><span class="s1">&#39;../data/atp_rankings_10s.csv&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings00</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings10</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

  <span class="n">ranking_date</span>  <span class="n">rank</span>  <span class="n">player</span>  <span class="n">points</span>
<span class="mi">0</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>     <span class="mi">1</span>  <span class="mi">101736</span>  <span class="mf">4135.0</span>
<span class="mi">1</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>     <span class="mi">2</span>  <span class="mi">102338</span>  <span class="mf">2915.0</span>
<span class="mi">2</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>     <span class="mi">3</span>  <span class="mi">101948</span>  <span class="mf">2419.0</span>
<span class="mi">3</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>     <span class="mi">4</span>  <span class="mi">103017</span>  <span class="mf">2184.0</span>
<span class="mi">4</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>     <span class="mi">5</span>  <span class="mi">102856</span>  <span class="mf">2169.0</span>
  <span class="n">ranking_date</span>  <span class="n">rank</span>  <span class="n">player</span>   <span class="n">points</span>
<span class="mi">0</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">1</span>  <span class="mi">103819</span>  <span class="mf">10550.0</span>
<span class="mi">1</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">2</span>  <span class="mi">104745</span>   <span class="mf">9205.0</span>
<span class="mi">2</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">3</span>  <span class="mi">104925</span>   <span class="mf">8310.0</span>
<span class="mi">3</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">4</span>  <span class="mi">104918</span>   <span class="mf">7030.0</span>
<span class="mi">4</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">5</span>  <span class="mi">105223</span>   <span class="mf">6785.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-9-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">load_atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">atp_rankings_file</span><span class="p">){</span>
    <span class="n">atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">atp_rankings_file</span><span class="p">,</span> <span class="n">col_types</span><span class="o">=</span><span class="nf">cols</span><span class="p">())</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate</span><span class="p">(</span><span class="n">ranking_date</span><span class="o">=</span><span class="nf">parse_date_time</span><span class="p">(</span><span class="n">ranking_date</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;%Y%m%d&#39;</span><span class="p">))</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">atp_rankings00</span> <span class="o">&lt;-</span> <span class="nf">load_atp_rankings</span><span class="p">(</span><span class="s">&#39;../data/atp_rankings_00s.csv&#39;</span><span class="p">)</span>
<span class="n">atp_rankings10</span> <span class="o">&lt;-</span> <span class="nf">load_atp_rankings</span><span class="p">(</span><span class="s">&#39;../data/atp_rankings_10s.csv&#39;</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">atp_rankings00</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_rankings10</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player</span>  <span class="n">points</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>
<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player</span>  <span class="n">points</span>
<span class="m">2010-01-04</span>      <span class="m">1</span>       <span class="m">103819</span>  <span class="m">10550</span>
<span class="m">2010-01-04</span>      <span class="m">2</span>       <span class="m">104745</span>  <span class="m">9205</span>
<span class="m">2010-01-04</span>      <span class="m">3</span>       <span class="m">104925</span>  <span class="m">8310</span>
<span class="m">2010-01-04</span>      <span class="m">4</span>       <span class="m">104918</span>  <span class="m">7030</span>
<span class="m">2010-01-04</span>      <span class="m">5</span>       <span class="m">105223</span>  <span class="m">6785</span>
<span class="m">2010-01-04</span>      <span class="m">6</span>       <span class="m">103786</span>  <span class="m">4930</span>
</pre></div>
</div>
</div>
</div>
<p>Now, as we have two datasets with identical column format, we’ll want to
concatenate these datasets together:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-10-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-10-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-10-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html">pandas.concat</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings00</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings10</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">atp_rankings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">atp_rankings00</span><span class="p">,</span> <span class="n">atp_rankings10</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">atp_rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="p">(</span><span class="mi">920907</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="mi">916296</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1837203</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player</span>  <span class="n">points</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-10-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/bind.html">Tidyverse bind_rows</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">atp_rankings00</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">atp_rankings10</span><span class="p">))</span>
<span class="n">atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">atp_rankings00</span><span class="p">,</span> <span class="n">atp_rankings10</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">))</span>

<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">920907</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">916296</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1837203</span>
<span class="c1"># A tibble: 6 x 4</span>
  <span class="n">ranking_date</span>         <span class="n">rank</span> <span class="n">player</span> <span class="n">points</span>
  <span class="o">&lt;</span><span class="n">dttm</span><span class="o">&gt;</span>              <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">1</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">1</span> <span class="m">101736</span>   <span class="m">4135</span>
<span class="m">2</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">2</span> <span class="m">102338</span>   <span class="m">2915</span>
<span class="m">3</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">3</span> <span class="m">101948</span>   <span class="m">2419</span>
<span class="m">4</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">4</span> <span class="m">103017</span>   <span class="m">2184</span>
<span class="m">5</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">5</span> <span class="m">102856</span>   <span class="m">2169</span>
<span class="m">6</span> <span class="m">2000-01-10</span> <span class="m">00</span><span class="o">:</span><span class="m">00</span><span class="o">:</span><span class="m">00</span>     <span class="m">6</span> <span class="m">102358</span>   <span class="m">2107</span>
</pre></div>
</div>
</div>
</div>
<p>At this point we can notice that the player identification number is not the
same on player- and ranking-datasets. We should rename this column, as we will
be using that to join these datasets together.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-11-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-11-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-11-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html">pandas.DataFrame.rename</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_rankings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;player_id&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">atp_rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-11-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/rename.html">Tidyverse rename</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_rankings</span> <span class="o">&lt;-</span> <span class="n">atp_rankings</span> <span class="o">%&gt;%</span>

    <span class="nf">rename</span><span class="p">(</span><span class="n">player_id</span><span class="o">=</span><span class="n">player</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have figured how we want to parse these datasets, let’s create a
function that can read multiple files with a for-loop structure.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-12-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-12-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-12-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_multiple_atp_rankings</span><span class="p">(</span><span class="n">atp_rankings_files</span><span class="p">):</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">atp_ranking_file</span> <span class="ow">in</span> <span class="n">atp_rankings_files</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_atp_rankings</span><span class="p">(</span><span class="n">atp_ranking_file</span><span class="p">)</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">atp_rankings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">atp_rankings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;player_id&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">atp_rankings</span>

<span class="n">atp_rankings</span> <span class="o">=</span> <span class="n">load_multiple_atp_rankings</span><span class="p">([</span><span class="s1">&#39;../data/atp_rankings_00s.csv&#39;</span><span class="p">,</span><span class="s1">&#39;../data/atp_rankings_10s.csv&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_rankings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">atp_rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="p">(</span><span class="mi">1837203</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-12-1 docutils container">
<p><a class="reference external" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/list">R list structure</a></p>
<p><a class="reference external" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/append">R append</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">load_multiple_atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">atp_rankings_files</span><span class="p">){</span>
    <span class="n">datasets</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">()</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">atp_ranking_file</span> <span class="n">in</span> <span class="n">atp_rankings_files</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataset</span> <span class="o">&lt;-</span> <span class="nf">load_atp_rankings</span><span class="p">(</span><span class="n">atp_ranking_file</span><span class="p">)</span>
        <span class="n">datasets</span> <span class="o">&lt;-</span> <span class="nf">append</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="nf">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="n">atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="nf">rename</span><span class="p">(</span><span class="n">player_id</span><span class="o">=</span><span class="n">player</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">atp_rankings</span> <span class="o">&lt;-</span> <span class="nf">load_multiple_atp_rankings</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;../data/atp_rankings_00s.csv&#39;</span><span class="p">,</span><span class="s">&#39;../data/atp_rankings_10s.csv&#39;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_rankings</span><span class="p">)</span>

<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1837203</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>
</pre></div>
</div>
</div>
</div>
<p>This new function provides an interesting feature: we do not need to create
duplicate variables for our new datasets. We could be reading 2 or 2000 files
and our function would work identically.</p>
<p>Let’s now combine this rankings dataset with our player dataset. Now we’re
going to do dataset joining with <code class="docutils literal notranslate"><span class="pre">player_id</span></code> as our joining column. As our
players dataset contains a lot of players who did not play during the time
period that we have in our rankings dataset, we should use the rankings
dataset as our master dataset and do a left join. This means that we only
join those rows from the players dataset that have corresponding player ID
in our rankings dataset.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-13-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-13-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-13-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas.DataFrame.merge">pandas.DataFrame.merge</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span> <span class="o">=</span> <span class="n">atp_rankings</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">atp_players</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atp_data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="n">atp_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">ranking_date</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">rank</span>                     <span class="n">int64</span>
<span class="n">player_id</span>                <span class="n">int64</span>
<span class="n">points</span>                 <span class="n">float64</span>
<span class="n">hand</span>                  <span class="n">category</span>
<span class="n">birth_date</span>      <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">country_code</span>          <span class="n">category</span>
<span class="n">name</span>                    <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-13-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/join.html">Tidyverse left_join</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span> <span class="o">&lt;-</span> <span class="n">atp_rankings</span> <span class="o">%&gt;%</span>
    <span class="nf">left_join</span><span class="p">(</span><span class="n">atp_players</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s">&#39;player_id&#39;</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">atp_data</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_data</span><span class="p">)</span>

<span class="n">Classes</span> ‘<span class="n">spec_tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl_df</span>’<span class="p">,</span> ‘<span class="n">tbl</span>’ <span class="n">and</span> <span class="s">&#39;data.frame&#39;</span><span class="o">:</span>        <span class="m">1837203</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">8</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">ranking_date</span><span class="o">:</span> <span class="n">POSIXct</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">&quot;2000-01-10&quot;</span> <span class="s">&quot;2000-01-10&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">rank</span>        <span class="o">:</span> <span class="n">num</span>  <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span> <span class="m">10</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">player_id</span>   <span class="o">:</span> <span class="n">num</span>  <span class="m">101736</span> <span class="m">102338</span> <span class="m">101948</span> <span class="m">103017</span> <span class="m">102856</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">points</span>      <span class="o">:</span> <span class="n">num</span>  <span class="m">4135</span> <span class="m">2915</span> <span class="m">2419</span> <span class="m">2184</span> <span class="m">2169</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">name</span>        <span class="o">:</span> <span class="n">chr</span>  <span class="s">&quot;Agassi, Andre&quot;</span> <span class="s">&quot;Kafelnikov, Yevgeny&quot;</span> <span class="s">&quot;Sampras, Pete&quot;</span> <span class="s">&quot;Kiefer, Nicolas&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">hand</span>        <span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">4</span> <span class="n">levels</span> <span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;L&quot;</span><span class="p">,</span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="s">&quot;U&quot;</span><span class="o">:</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">2</span> <span class="m">3</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">birth_date</span>  <span class="o">:</span> <span class="n">POSIXct</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">&quot;1970-04-29&quot;</span> <span class="s">&quot;1974-02-18&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">country_code</span><span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">210</span> <span class="n">levels</span> <span class="s">&quot;AFG&quot;</span><span class="p">,</span><span class="s">&quot;AHO&quot;</span><span class="p">,</span><span class="s">&quot;ALB&quot;</span><span class="p">,</span><span class="n">..</span><span class="o">:</span> <span class="m">200</span> <span class="m">161</span> <span class="m">200</span> <span class="m">76</span> <span class="m">28</span> <span class="m">179</span> <span class="m">62</span> <span class="m">200</span> <span class="m">43</span> <span class="m">137</span> <span class="kc">...</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>    <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>     <span class="n">R</span>       <span class="m">1974-02-18</span>      <span class="n">RUS</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>    <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>         <span class="n">R</span>       <span class="m">1977-07-05</span>      <span class="n">GER</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>    <span class="n">Enqvist</span><span class="p">,</span> <span class="n">Thomas</span>         <span class="n">R</span>       <span class="m">1974-03-13</span>      <span class="n">SWE</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-parsing-premiere-league-games-problems-3-4-and-5 challenge admonition">
<p class="admonition-title">Parsing Premiere League games - Problems 3, 4 and 5</p>
<p>The exercise is provided in <code class="docutils literal notranslate"><span class="pre">X_exercises/ch2-X-ex1.ipynb</span></code>.</p>
<p>In this exercise we’ll create input parsing functions for
<a class="reference external" href="https://github.com/footballcsv/england">Premier League results</a>.</p>
<p>Problems 3, 4 and 5:</p>
<ol class="arabic simple" start="3">
<li><p>Create a function that formats the data into a tidy format and adds
additional information based on existing data.</p></li>
<li><p>Create a function that turns some of our columns into categorical
format.</p></li>
<li><p>Create a function that can combine multiple data files into a single
dataset.</p></li>
</ol>
<p>After solving problem 2 and 3 you can try out two demonstrations of what
can be done with the data:</p>
<ol class="arabic simple">
<li><p>Check whether home side has an advantage in football games.</p></li>
<li><p>Calculate Premier League winners.</p></li>
</ol>
</div>
</div>
<div class="section" id="demonstrating-atp-dataset-longest-reign-at-rank-1">
<h3>Demonstrating ATP dataset: Longest reign at rank 1<a class="headerlink" href="#demonstrating-atp-dataset-longest-reign-at-rank-1" title="Permalink to this headline">¶</a></h3>
<p>Let’s use our newly generated dataset to find out who has had the longest
reign at top 1 spot during this time period. Now we’re only interested on
players that have attained rank 1. Let’s pick only those rows.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-14-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-14-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-14-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#different-choices-for-indexing">Pandas indexing</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">pandas.DataFrame.loc</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1</span> <span class="o">=</span> <span class="n">atp_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">atp_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">atp_top1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1572</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">3143</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">4713</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">5045.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">6287</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">07</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">5045.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-14-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/filter.html">Tidyverse filter</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Better when we want to drop rows</span>
<span class="n">atp_top1</span> <span class="o">&lt;-</span> <span class="n">atp_data</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">rank</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span>

<span class="c1"># or</span>

<span class="c1"># Logical indexing is more useful when we want to edit certain rows</span>
<span class="n">atp_top1</span> <span class="o">&lt;-</span> <span class="n">atp_data</span><span class="p">[</span><span class="n">atp_data</span><span class="p">[</span><span class="s">&#39;rank&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="m">1</span><span class="p">,]</span>

<span class="nf">head</span><span class="p">(</span><span class="n">atp_top1</span><span class="p">)</span>

 <span class="n">ranking_date</span>   <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-17</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-24</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-31</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-02-07</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-02-14</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
</pre></div>
</div>
</div>
</div>
<p>In order to see when the top 1 rank holder has changed we’ll create a new
column <code class="docutils literal notranslate"><span class="pre">previous_top</span></code> that contains a shifted version of the player name.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-15-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-15-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-15-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html">pandas.DataFrame.shift</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;previous_top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atp_top1</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atp_top1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>    <span class="n">previous_top</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">NaN</span>
<span class="mi">1572</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="mf">101736.0</span>
<span class="mi">3143</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="mf">101736.0</span>
<span class="mi">4713</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">5045.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="mf">101736.0</span>
<span class="mi">6287</span>    <span class="mi">2000</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">07</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">5045.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="mf">101736.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-15-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/lead-lag.html">Tidyverse lag</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1</span> <span class="o">&lt;-</span> <span class="n">atp_top1</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">previous_top</span><span class="o">=</span><span class="nf">lag</span><span class="p">(</span><span class="n">player_id</span><span class="p">))</span>

<span class="nf">head</span><span class="p">(</span><span class="n">atp_top1</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">previous_top</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="kc">NA</span>
<span class="m">2000-01-17</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="m">101736</span>
<span class="m">2000-01-24</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="m">101736</span>
<span class="m">2000-01-31</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="m">101736</span>
<span class="m">2000-02-07</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="m">101736</span>
<span class="m">2000-02-14</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">5045</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>     <span class="m">101736</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s further limit ourselves to those observations where the reign has
changed. That is, rank 1 player is different to previous player.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-16-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-16-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-16-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1_reigns</span> <span class="o">=</span> <span class="n">atp_top1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">atp_top1</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">atp_top1</span><span class="p">[</span><span class="s1">&#39;previous_top&#39;</span><span class="p">],:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">atp_top1_reigns</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>    <span class="n">previous_top</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">NaN</span>
<span class="mi">55359</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">11</span>      <span class="mi">1</span>       <span class="mi">101948</span>  <span class="mf">3739.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="mf">101736.0</span>
<span class="mi">71523</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">20</span>      <span class="mi">1</span>       <span class="mi">103498</span>  <span class="mf">3920.0</span>  <span class="n">R</span>       <span class="mi">1980</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span>      <span class="n">RUS</span>     <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="mf">101948.0</span>
<span class="mi">74761</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">04</span>      <span class="mi">1</span>       <span class="mi">102856</span>  <span class="mf">4195.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="mf">103498.0</span>
<span class="mi">87617</span>   <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">29</span>      <span class="mi">1</span>       <span class="mi">103498</span>  <span class="mf">4265.0</span>  <span class="n">R</span>       <span class="mi">1980</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span>      <span class="n">RUS</span>     <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="mf">102856.0</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-16-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Better when we want to drop rows</span>
<span class="n">atp_top1_reigns</span> <span class="o">&lt;-</span> <span class="n">atp_top1</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">player_id</span> <span class="o">!=</span> <span class="n">previous_top</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_top1_reigns</span><span class="p">)</span>

<span class="c1"># Logical indexing is more useful when we want to edit certain rows</span>
<span class="n">atp_top1_reigns</span> <span class="o">&lt;-</span> <span class="nf">drop_na</span><span class="p">(</span><span class="n">atp_top1</span><span class="p">[</span><span class="n">atp_top1</span><span class="p">[</span><span class="s">&#39;player_id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">atp_top1</span><span class="p">[</span><span class="s">&#39;previous_top&#39;</span><span class="p">],])</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_top1_reigns</span><span class="p">)</span>

 <span class="n">ranking_date</span>   <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">previous_top</span>
<span class="m">2000-09-11</span>      <span class="m">1</span>       <span class="m">101948</span>  <span class="m">3739</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>     <span class="m">101736</span>
<span class="m">2000-11-20</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">3920</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">101948</span>
<span class="m">2000-12-04</span>      <span class="m">1</span>       <span class="m">102856</span>  <span class="m">4195</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>     <span class="m">103498</span>
<span class="m">2001-01-29</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">4265</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">102856</span>
<span class="m">2001-02-26</span>      <span class="m">1</span>       <span class="m">102856</span>  <span class="m">4365</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>     <span class="m">103498</span>
<span class="m">2001-04-02</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">4270</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">102856</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll want to calculate the reign lengths of our top 1 players. To do this
we’ll calculate the difference on our ranking dates and shift it so that the
result matches the player.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-17-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-17-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-17-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.diff.html">pandas.DataFrame.diff</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1_reigns</span><span class="p">[</span><span class="s1">&#39;reign_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atp_top1_reigns</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ranking_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atp_top1_reigns</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>    <span class="n">previous_top</span>    <span class="n">reign_length</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>           <span class="n">NaN</span>             <span class="mi">245</span> <span class="n">days</span>
<span class="mi">55359</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">11</span>      <span class="mi">1</span>       <span class="mi">101948</span>  <span class="mf">3739.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>           <span class="mf">101736.0</span>        <span class="mi">70</span> <span class="n">days</span>
<span class="mi">71523</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">20</span>      <span class="mi">1</span>       <span class="mi">103498</span>  <span class="mf">3920.0</span>  <span class="n">R</span>       <span class="mi">1980</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span>      <span class="n">RUS</span>     <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>            <span class="mf">101948.0</span>        <span class="mi">14</span> <span class="n">days</span>
<span class="mi">74761</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">04</span>      <span class="mi">1</span>       <span class="mi">102856</span>  <span class="mf">4195.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="mf">103498.0</span>        <span class="mi">56</span> <span class="n">days</span>
<span class="mi">87617</span>   <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">29</span>      <span class="mi">1</span>       <span class="mi">103498</span>  <span class="mf">4265.0</span>  <span class="n">R</span>       <span class="mi">1980</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span>      <span class="n">RUS</span>     <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>            <span class="mf">102856.0</span>        <span class="mi">28</span> <span class="n">days</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-17-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/lead-lag.html">Tidyverse lead</a></p>
<p><a class="reference external" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/difftime">R difftime</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1_reigns</span> <span class="o">&lt;-</span> <span class="n">atp_top1_reigns</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">reign_length</span><span class="o">=</span><span class="nf">difftime</span><span class="p">(</span><span class="nf">lead</span><span class="p">(</span><span class="n">ranking_date</span><span class="p">),</span> <span class="n">ranking_date</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_top1_reigns</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">previous_top</span>    <span class="n">reign_length</span>
<span class="m">2000-09-11</span>      <span class="m">1</span>       <span class="m">101948</span>  <span class="m">3739</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>     <span class="m">101736</span>  <span class="m">70</span> <span class="n">days</span>
<span class="m">2000-11-20</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">3920</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">101948</span>  <span class="m">14</span> <span class="n">days</span>
<span class="m">2000-12-04</span>      <span class="m">1</span>       <span class="m">102856</span>  <span class="m">4195</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>     <span class="m">103498</span>  <span class="m">56</span> <span class="n">days</span>
<span class="m">2001-01-29</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">4265</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">102856</span>  <span class="m">28</span> <span class="n">days</span>
<span class="m">2001-02-26</span>      <span class="m">1</span>       <span class="m">102856</span>  <span class="m">4365</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>     <span class="m">103498</span>  <span class="m">35</span> <span class="n">days</span>
<span class="m">2001-04-02</span>      <span class="m">1</span>       <span class="m">103498</span>  <span class="m">4270</span>    <span class="n">Safin</span><span class="p">,</span> <span class="n">Marat</span>    <span class="n">R</span>       <span class="m">1980-01-27</span>      <span class="n">RUS</span>     <span class="m">102856</span>  <span class="m">21</span> <span class="n">days</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s sort these values to obtain the longest reigns. When we compare the
results with
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_ATP_number_1_ranked_singles_tennis_players#Weeks_at_No._1">this list</a>
of top reigns, we see that we have captured many of these reigns in our dataset.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-18-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-18-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-18-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html">pandas.DataFrame.sort_values</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1_reigns</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;reign_length&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>    <span class="n">previous_top</span>    <span class="n">reign_length</span>
<span class="mi">346974</span>          <span class="mi">2004</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">02</span>      <span class="mi">1</span>       <span class="mi">103819</span>  <span class="mf">5225.0</span>          <span class="n">R</span>       <span class="mi">1981</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span>      <span class="n">SUI</span>     <span class="n">Federer</span><span class="p">,</span> <span class="n">Roger</span>          <span class="mf">104053.0</span>        <span class="mi">1659</span> <span class="n">days</span>
<span class="mi">1331200</span>         <span class="mi">2014</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">07</span>      <span class="mi">1</span>       <span class="mi">104925</span>  <span class="mf">13130.0</span>         <span class="n">R</span>       <span class="mi">1987</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">22</span>      <span class="n">SRB</span>     <span class="n">Djokovic</span><span class="p">,</span> <span class="n">Novak</span>         <span class="mf">104745.0</span>        <span class="mi">854</span> <span class="n">days</span>
<span class="mi">155503</span>          <span class="mi">2001</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span>      <span class="mi">1</span>       <span class="mi">103720</span>  <span class="mf">4365.0</span>          <span class="n">R</span>       <span class="mi">1981</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span>      <span class="n">AUS</span>     <span class="n">Hewitt</span><span class="p">,</span> <span class="n">Lleyton</span>         <span class="mf">102856.0</span>        <span class="mi">525</span> <span class="n">days</span>
<span class="mi">960449</span>          <span class="mi">2010</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">07</span>      <span class="mi">1</span>       <span class="mi">104745</span>  <span class="mf">8700.0</span>          <span class="n">L</span>       <span class="mi">1986</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span>      <span class="n">ESP</span>     <span class="n">Nadal</span><span class="p">,</span> <span class="n">Rafael</span>           <span class="mf">103819.0</span>        <span class="mi">392</span> <span class="n">days</span>
<span class="mi">1050927</span>         <span class="mi">2011</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">04</span>      <span class="mi">1</span>       <span class="mi">104925</span>  <span class="mf">13285.0</span>         <span class="n">R</span>       <span class="mi">1987</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">22</span>      <span class="n">SRB</span>     <span class="n">Djokovic</span><span class="p">,</span> <span class="n">Novak</span>         <span class="mf">104745.0</span>        <span class="mi">371</span> <span class="n">days</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-18-1 docutils container">
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/top_n.html">Tidyverse top_n</a></p>
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/arrange.html">Tidyverse arrange</a></p>
<p><a class="reference external" href="https://dplyr.tidyverse.org/reference/desc.html">Tidyverse desc</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">atp_top1_reigns</span> <span class="o">%&gt;%</span>
    <span class="nf">top_n</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">reign_length</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">reign_length</span><span class="p">))</span>

 <span class="n">ranking_date</span>   <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">previous_top</span>    <span class="n">reign_length</span>
<span class="m">2004-02-02</span>      <span class="m">1</span>       <span class="m">103819</span>  <span class="m">5225</span>    <span class="n">Federer</span><span class="p">,</span> <span class="n">Roger</span>  <span class="n">R</span>       <span class="m">1981-08-08</span>      <span class="n">SUI</span>     <span class="m">104053</span>  <span class="m">1659</span> <span class="n">days</span>
<span class="m">2014-07-07</span>      <span class="m">1</span>       <span class="m">104925</span>  <span class="m">13130</span>   <span class="n">Djokovic</span><span class="p">,</span> <span class="n">Novak</span> <span class="n">R</span>       <span class="m">1987-05-22</span>      <span class="n">SRB</span>     <span class="m">104745</span>  <span class="m">854</span> <span class="n">days</span>
<span class="m">2001-11-19</span>      <span class="m">1</span>       <span class="m">103720</span>  <span class="m">4365</span>    <span class="n">Hewitt</span><span class="p">,</span> <span class="n">Lleyton</span> <span class="n">R</span>       <span class="m">1981-02-24</span>      <span class="n">AUS</span>     <span class="m">102856</span>  <span class="m">525</span> <span class="n">days</span>
<span class="m">2010-06-07</span>      <span class="m">1</span>       <span class="m">104745</span>  <span class="m">8700</span>    <span class="n">Nadal</span><span class="p">,</span> <span class="n">Rafael</span>   <span class="n">L</span>       <span class="m">1986-06-03</span>      <span class="n">ESP</span>     <span class="m">103819</span>  <span class="m">392</span> <span class="n">days</span>
<span class="m">2011-07-04</span>      <span class="m">1</span>       <span class="m">104925</span>  <span class="m">13285</span>   <span class="n">Djokovic</span><span class="p">,</span> <span class="n">Novak</span> <span class="n">R</span>       <span class="m">1987-05-22</span>      <span class="n">SRB</span>     <span class="m">104745</span>  <span class="m">371</span> <span class="n">days</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="using-binary-data-formats-to-improve-your-pipeline">
<span id="chapter2-binary"></span><h2>Using binary data formats to improve your pipeline<a class="headerlink" href="#using-binary-data-formats-to-improve-your-pipeline" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-binary-data-formats">
<h3>Why binary data formats?<a class="headerlink" href="#why-binary-data-formats" title="Permalink to this headline">¶</a></h3>
<p>Quite often raw data is provided as CSVs or other delimited files (e.g.
<code class="docutils literal notranslate"><span class="pre">.dat</span></code>-files). Sometimes you have a zips that contain huge amount of
individual files or images. Reading such files can be slow, resource intensive,
bad for a shared file system and complicated as one needs to do parsing each
time the files are loaded.</p>
<p>In situations like it is usually a good idea to do basic parsing for the data
and store a working copy of the data in a binary format. Even though this
causes data duplication, the performance benefits will easily outweight this
cost. Benefits of binary formats include:</p>
<ul class="simple">
<li><p>Data size is reduced due to better encodings (e.g. ASCII vs. binary float).</p></li>
<li><p>Data loading is much faster due to reduced parsing and better buffering
behavior.</p></li>
<li><p>All of the data does not need to be loaded in order to access parts of the
data.</p></li>
<li><p>Raw data can be stored in a separate location which reduces the risk of
spoiling the raw data.</p></li>
</ul>
<p>One should take few things into account when using binary data formats:</p>
<ul class="simple">
<li><p>Choose a binary format that best suits the problem at hand. There isn’t
<strong>one</strong> data format that works in all cases.</p></li>
<li><p>Write the files programatically using pipeline functions. This makes
testing easier and allows others to replicate your data format from
the raw data.</p></li>
<li><p>If the format supports metadata attributes, use them to store e.g. code
revision used to create the dataset, hyperparameters of the model used
etc.</p></li>
</ul>
<p>Of course one should also use binary data formats to store temporary
data or intermediate results from the models. Easily readable/transferable
formats such as CSVs can be used when the results are being shared and
datasets are published, but due to reasons mentioned before, they are not
optimal for storing temporary results.</p>
</div>
<div class="section" id="csvs">
<h3>CSVs<a class="headerlink" href="#csvs" title="Permalink to this headline">¶</a></h3>
<p>CSVs (and other delimited text files) are common, but they are rarely the best
format to use throughout a pipeline. Raw datasets are often provided in CSV
format as it is very easy to transport.</p>
<p><strong>Pros:</strong></p>
<ol class="arabic simple">
<li><p>CSVs are human readable, so data loading is easy to verify.</p></li>
<li><p>They area usually easy to parse.</p></li>
<li><p>Easy to share with other users.</p></li>
</ol>
<p><strong>Cons</strong>:</p>
<ol class="arabic simple">
<li><p>One usually needs to manually specify column names, column types, delimiters
etc.</p></li>
<li><p>Data is stored very inefficiently. Storing e.g. a floating point number in
ASCII takes a lot more space than storing it as binary.</p></li>
<li><p>Using bad data readers (e.g. reading file without <cite>read_csv</cite>-functions) can
result in huge number of small IO operations as text reading usually reads
file some 4-64 kB at a time (a.k.a. small buffer size).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> data loaders usually require lots of memory as data needs to be
first loaded as generic strings before it can be parsed to binary columns.</p></li>
<li><p>Reading huge CSV files requires using more advanced libraries like
<a class="reference external" href="https://dask.org/">Dask</a> (Python) or
<a class="reference external" href="https://github.com/Rdatatable/data.table">data.table</a> (R).</p></li>
</ol>
<p>There are many binary data formats that one can use to mitigate most of these
issues. We’ll be looking at them next, but first let’s save our data as a CSV
file using the writing functions.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-19-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-19-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-19-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html">pandas.DataFrame.to_csv</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">pandas.read_csv</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.csv&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">Unnamed</span><span class="p">:</span> <span class="mi">0</span>      <span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-19-1 docutils container">
<p><a class="reference external" href="https://readr.tidyverse.org/reference/write_delim.html">R tidyverse write_csv</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">write_csv</span><span class="p">(</span><span class="n">atp_data</span><span class="p">,</span> <span class="s">&#39;../data/atp_data_r.csv&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&#39;../data/atp_data_r.csv&#39;</span><span class="p">))</span>

<span class="n">Parsed</span> <span class="n">with</span> <span class="n">column</span> <span class="n">specification</span><span class="o">:</span>
<span class="nf">cols</span><span class="p">(</span>
  <span class="n">ranking_date</span> <span class="o">=</span> <span class="nf">col_datetime</span><span class="p">(</span><span class="n">format</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
  <span class="n">rank</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">player_id</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">points</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">name</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">hand</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
  <span class="n">birth_date</span> <span class="o">=</span> <span class="nf">col_datetime</span><span class="p">(</span><span class="n">format</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
  <span class="n">country_code</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>    <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>     <span class="n">R</span>       <span class="m">1974-02-18</span>      <span class="n">RUS</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>    <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>         <span class="n">R</span>       <span class="m">1977-07-05</span>      <span class="n">GER</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>    <span class="n">Enqvist</span><span class="p">,</span> <span class="n">Thomas</span>         <span class="n">R</span>       <span class="m">1974-03-13</span>      <span class="n">SWE</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="serialized-objects">
<h3>Serialized objects<a class="headerlink" href="#serialized-objects" title="Permalink to this headline">¶</a></h3>
<p>Serialized objects are basically the objects stored into file as they are in
memory. In Python the default serialized format is Pickle and in R Rdata.</p>
<p><strong>Pros:</strong></p>
<ol class="arabic simple">
<li><p>Easy to write and read.</p></li>
<li><p>Binary data format.</p></li>
<li><p>Data can be automatically compressed.</p></li>
</ol>
<p><strong>Cons:</strong></p>
<ol class="arabic simple">
<li><p>Data needs to be read as is was. You cannot easily read only parts of it.</p></li>
<li><p>Somewhat unreliable to share.</p></li>
<li><p>Buffer size is most likely not very big.</p></li>
</ol>
<p>Serialized objects are good for debugging the state of the code, but not
necessarily best for actual data storage or transporting to collaborators.
At the same time they support all kinds of objects, so they are good if
you do not have a better format.</p>
<p>Let’s save our <code class="docutils literal notranslate"><span class="pre">atp_data</span></code>-dataset using these formats:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-20-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-20-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-20-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_pickle.html">pandas.DataFrame.to_pickle</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_pickle.html">pandas.read_pickle</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;../data/atp_data.pickle.gz&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;../data/atp_data.pickle.gz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-20-1 docutils container">
<p><a class="reference external" href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/save.html">R save</a></p>
<p><a class="reference external" href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/load.html">R load</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">save</span><span class="p">(</span><span class="n">atp_data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s">&#39;../data/atp_data.Rdata&#39;</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">atp_data</span><span class="p">)</span>

<span class="nf">load</span><span class="p">(</span><span class="s">&#39;../data/atp_data.Rdata&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">atp_data</span><span class="p">)</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>    <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>     <span class="n">R</span>       <span class="m">1974-02-18</span>      <span class="n">RUS</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>    <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>         <span class="n">R</span>       <span class="m">1977-07-05</span>      <span class="n">GER</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>    <span class="n">Enqvist</span><span class="p">,</span> <span class="n">Thomas</span>         <span class="n">R</span>       <span class="m">1974-03-13</span>      <span class="n">SWE</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="feather">
<h3>Feather<a class="headerlink" href="#feather" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The course <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> contains a older implementations
of the feather-format from <code class="docutils literal notranslate"><span class="pre">feather</span></code>-library.</p>
<p>Nowadays R has a faster feather in
<a class="reference external" href="http://arrow.apache.org/blog/2019/08/08/r-package-on-cran/">arrow-library</a>.</p>
<p>Likewise Python implementation is nowadays included in
<a class="reference external" href="https://arrow.apache.org/docs/python/feather.html">pyarrow-library</a>,
and <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> installed the old version, which no longer works.</p>
<p>To install the newer versions, please run</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">--freeze-installed</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">pyarrow=1.0.1</span> <span class="pre">r-arrow=1.0.1</span> <span class="pre">r-vctrs</span></code></p>
<p>in an Anaconda shell.</p>
<p>Please use the <code class="docutils literal notranslate"><span class="pre">arrow</span></code>-versions, if you want to use feather with your
own code.</p>
</div>
<p><a class="reference external" href="https://github.com/wesm/feather">Feather format</a> is a data format for
efficient storing of tabular data. It’s built on top of Apache Arrow columnar
data specification and it was created by the developers of Pandas and
Tidyverse to allow writing and reading big tables from both Pandas and R.
Nowadays it’s development is deeply connected with the Apache Arrow format.</p>
<p><strong>Pros</strong>:</p>
<ol class="arabic simple">
<li><p>Easy to write and read.</p></li>
<li><p>Very fast.</p></li>
<li><p>Good for columnar data.</p></li>
<li><p>Good format for moving columnar data between R and Python.</p></li>
</ol>
<p><strong>Cons</strong>:</p>
<ol class="arabic simple">
<li><p>Only for tabular data.</p></li>
<li><p>Limited amount of supported column data formats.</p></li>
<li><p>Not something for long term storage as the format is quite new.</p></li>
</ol>
<p>Let’s save our <code class="docutils literal notranslate"><span class="pre">atp_data</span></code>-dataset using feather:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-21-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-21-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-21-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_feather.html">pandas.DataFrame.to_feather</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_feather.html">pandas.read_feather</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span><span class="o">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.feather&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.feather&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-21-1 docutils container">
<p><a class="reference external" href="https://arrow.apache.org/docs/r/reference/write_feather.html">arrow’s write_feather</a>
<a class="reference external" href="https://arrow.apache.org/docs/r/reference/read_feather.html">arrow’s read_feather</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
<span class="nf">write_feather</span><span class="p">(</span><span class="n">atp_data</span> <span class="p">,</span><span class="s">&#39;../data/atp_data_r.feather&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">read_feather</span><span class="p">(</span><span class="s">&#39;../data/atp_data_r.feather&#39;</span><span class="p">))</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>    <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>     <span class="n">R</span>       <span class="m">1974-02-18</span>      <span class="n">RUS</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>    <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>         <span class="n">R</span>       <span class="m">1977-07-05</span>      <span class="n">GER</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>    <span class="n">Enqvist</span><span class="p">,</span> <span class="n">Thomas</span>         <span class="n">R</span>       <span class="m">1974-03-13</span>      <span class="n">SWE</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parquet">
<h3>Parquet<a class="headerlink" href="#parquet" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://parquet.apache.org/">Apache Parquet</a> is a columnar data format that
many big data systems use to store data in their backend.
<a class="reference external" href="https://github.com/apache/parquet-format">The format</a> uses multiple levels
of encoding and compression to reduce file size.</p>
<p><strong>Pros:</strong></p>
<ol class="arabic simple">
<li><p>Easy to write and read.</p></li>
<li><p>Very efficient spacewise.</p></li>
<li><p>Good for long-term storage.</p></li>
<li><p>Easy to read into big data applications (Spark/Hadoop/etc.)</p></li>
<li><p>Good interoperability between different languages.</p></li>
<li><p>Supports metadata in data files.</p></li>
</ol>
<p><strong>Cons:</strong></p>
<ol class="arabic simple">
<li><p>Slower to read from / write to disk due to encoding and compression.</p></li>
<li><p>Big data access needs well designed workflows for efficient data loading.</p></li>
</ol>
<p>Wes McKinney has made a
<a class="reference external" href="https://ursalabs.org/blog/2019-10-columnar-perf/">good blog post</a> about
performance of Feather, Parquet and other popular formats.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-22-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-22-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-22-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_parquet.html">pandas.DataFrame.to_parquet</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_parquet.html">pandas.read_parquet</a></p>
<p><a class="reference external" href="http://arrow.apache.org/docs/python/parquet.html">pyarrow’s parquet-functionality</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.parquet&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.parquet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-22-1 docutils container">
<p><a class="reference external" href="https://arrow.apache.org/docs/r/reference/write_parquet.html">arrow-library’s write_parquet</a>
<a class="reference external" href="https://arrow.apache.org/docs/r/reference/read_parquet.html">arrow-library’s read_parquet</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
<span class="nf">write_parquet</span><span class="p">(</span><span class="n">atp_data</span> <span class="p">,</span><span class="s">&#39;../data/atp_data_r.parquet&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">read_parquet</span><span class="p">(</span><span class="s">&#39;../data/atp_data_r.parquet&#39;</span><span class="p">))</span>

<span class="n">ranking_date</span>    <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">name</span>    <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>
<span class="m">2000-01-10</span>      <span class="m">1</span>       <span class="m">101736</span>  <span class="m">4135</span>    <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>   <span class="n">R</span>       <span class="m">1970-04-29</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">2</span>       <span class="m">102338</span>  <span class="m">2915</span>    <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>     <span class="n">R</span>       <span class="m">1974-02-18</span>      <span class="n">RUS</span>
<span class="m">2000-01-10</span>      <span class="m">3</span>       <span class="m">101948</span>  <span class="m">2419</span>    <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>   <span class="n">R</span>       <span class="m">1971-08-12</span>      <span class="n">USA</span>
<span class="m">2000-01-10</span>      <span class="m">4</span>       <span class="m">103017</span>  <span class="m">2184</span>    <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>         <span class="n">R</span>       <span class="m">1977-07-05</span>      <span class="n">GER</span>
<span class="m">2000-01-10</span>      <span class="m">5</span>       <span class="m">102856</span>  <span class="m">2169</span>    <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>        <span class="n">R</span>       <span class="m">1976-09-10</span>      <span class="n">BRA</span>
<span class="m">2000-01-10</span>      <span class="m">6</span>       <span class="m">102358</span>  <span class="m">2107</span>    <span class="n">Enqvist</span><span class="p">,</span> <span class="n">Thomas</span>         <span class="n">R</span>       <span class="m">1974-03-13</span>      <span class="n">SWE</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="hdf5">
<h3>HDF5<a class="headerlink" href="#hdf5" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>R interface to HDF was missing from <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>. If you want to
install it, please run</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">--freeze-installed</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">r-hdf5r</span></code></p>
<p>in an Anaconda shell.</p>
</div>
<p>Hierarchical Data Format version 5 (HDF5) is a binary format designed to store
multiple datasets in a single file. It is especially used to store array data
in physics and similar fields with large arrays, but it can be used to store
other data as well.</p>
<p><strong>Pros:</strong></p>
<ol class="arabic simple">
<li><p>Good for matrices or other big binary arrays.</p></li>
<li><p>Hierarchical data format where you can store multiple datasets and metadata
in a single file.</p></li>
<li><p>Fast when reading big chunks.</p></li>
<li><p>Good for sharing finished datasets.</p></li>
</ol>
<p><strong>Cons:</strong></p>
<ol class="arabic simple">
<li><p>Bad performance when you want to do random reads from within a dataset.</p></li>
<li><p>Similar directory management hassle as with individual files.</p></li>
<li><p>Pandas HDF5 interface uses pickled pytables-objects, so the format
is no longer that good for sharing.
<a class="reference external" href="https://www.h5py.org/">h5py</a> is a better interface for full access
to all HDF features.</p></li>
<li><p>R interface is quite clunky.</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-23-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-23-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-23-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_feather.html">pandas.DataFrame.to_hdf</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_feather.html">pandas.read_hdf</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atp_data</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;/atp_data&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;../data/atp_data_python.h5&#39;</span><span class="p">,</span><span class="s1">&#39;/atp_data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

    <span class="n">ranking_date</span>        <span class="n">rank</span>    <span class="n">player_id</span>       <span class="n">points</span>  <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">1</span>       <span class="mi">101736</span>  <span class="mf">4135.0</span>  <span class="n">R</span>       <span class="mi">1970</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>      <span class="n">USA</span>     <span class="n">Agassi</span><span class="p">,</span> <span class="n">Andre</span>
<span class="mi">1</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">2</span>       <span class="mi">102338</span>  <span class="mf">2915.0</span>  <span class="n">R</span>       <span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span>      <span class="n">RUS</span>     <span class="n">Kafelnikov</span><span class="p">,</span> <span class="n">Yevgeny</span>
<span class="mi">2</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">3</span>       <span class="mi">101948</span>  <span class="mf">2419.0</span>  <span class="n">R</span>       <span class="mi">1971</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span>      <span class="n">USA</span>     <span class="n">Sampras</span><span class="p">,</span> <span class="n">Pete</span>
<span class="mi">3</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">4</span>       <span class="mi">103017</span>  <span class="mf">2184.0</span>  <span class="n">R</span>       <span class="mi">1977</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span>      <span class="n">GER</span>     <span class="n">Kiefer</span><span class="p">,</span> <span class="n">Nicolas</span>
<span class="mi">4</span>       <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="mi">5</span>       <span class="mi">102856</span>  <span class="mf">2169.0</span>  <span class="n">R</span>       <span class="mi">1976</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span>      <span class="n">BRA</span>     <span class="n">Kuerten</span><span class="p">,</span> <span class="n">Gustavo</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-23-1 docutils container">
<p><a class="reference external" href="https://cran.r-project.org/web/packages/hdf5r/vignettes/hdf5r.html">R hdf5r-package</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">hdf5r</span><span class="p">)</span>
<span class="n">h5_file</span> <span class="o">&lt;-</span> <span class="n">H5File</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="s">&#39;../data/atp_data_r.h5&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">h5_group</span> <span class="o">&lt;-</span> <span class="n">h5_file</span><span class="o">$</span><span class="nf">create_group</span><span class="p">(</span><span class="s">&#39;atp_data&#39;</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">column</span> <span class="n">in</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">atp_data</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">h5_group</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">atp_data</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">h5_group</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">h5_file</span><span class="p">)</span>

<span class="n">h5_file</span><span class="o">$</span><span class="nf">close_all</span><span class="p">()</span>

<span class="n">Class</span><span class="o">:</span> <span class="n">H5Group</span>
<span class="n">Filename</span><span class="o">:</span> <span class="o">/</span><span class="n">u</span><span class="o">/</span><span class="m">59</span><span class="o">/</span><span class="n">tuomiss1</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">dataanalysis</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">analysis</span><span class="o">-</span><span class="n">workflows</span><span class="o">-</span><span class="n">course</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">atp_data_r.h5</span>
<span class="n">Group</span><span class="o">:</span> <span class="o">/</span><span class="n">atp_data</span>
<span class="n">Listing</span><span class="o">:</span>
         <span class="n">name</span>    <span class="n">obj_type</span> <span class="n">dataset.dims</span> <span class="n">dataset.type_class</span>
   <span class="n">birth_date</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>          <span class="n">H5T_FLOAT</span>
 <span class="n">country_code</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>           <span class="n">H5T_ENUM</span>
         <span class="n">hand</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>           <span class="n">H5T_ENUM</span>
         <span class="n">name</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>         <span class="n">H5T_STRING</span>
    <span class="n">player_id</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>          <span class="n">H5T_FLOAT</span>
       <span class="n">points</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>          <span class="n">H5T_FLOAT</span>
         <span class="n">rank</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>          <span class="n">H5T_FLOAT</span>
 <span class="n">ranking_date</span> <span class="n">H5I_DATASET</span>      <span class="m">1837203</span>          <span class="n">H5T_FLOAT</span>
<span class="n">Class</span><span class="o">:</span> <span class="n">H5File</span>
<span class="n">Filename</span><span class="o">:</span> <span class="o">/</span><span class="n">u</span><span class="o">/</span><span class="m">59</span><span class="o">/</span><span class="n">tuomiss1</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">dataanalysis</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">analysis</span><span class="o">-</span><span class="n">workflows</span><span class="o">-</span><span class="n">course</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">atp_data_r.h5</span>
<span class="n">Access</span> <span class="n">type</span><span class="o">:</span> <span class="n">H5F_ACC_RDWR</span>
<span class="n">Listing</span><span class="o">:</span>
     <span class="n">name</span>  <span class="n">obj_type</span> <span class="n">dataset.dims</span> <span class="n">dataset.type_class</span>
 <span class="n">atp_data</span> <span class="n">H5I_GROUP</span>         <span class="o">&lt;</span><span class="kc">NA</span><span class="o">&gt;</span>               <span class="o">&lt;</span><span class="kc">NA</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="binary-data-formats-sizes">
<h3>Binary data formats’ sizes<a class="headerlink" href="#binary-data-formats-sizes" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 37%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data format</p></th>
<th class="head"><p>Filename</p></th>
<th class="head"><p>File size</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Original data without joining</p></td>
<td><p>atp_players.csv</p>
<p>atp_rankings_00s.csv</p>
<p>atp_rankings_10s.csv</p>
</td>
<td><p>1.9 MB</p>
<p>21 MB</p>
<p>21 MB</p>
</td>
</tr>
<tr class="row-odd"><td><p>Saved CSV</p></td>
<td><p>atp_data_python.csv</p>
<p>atp_data_r.csv</p>
</td>
<td><p>123 MB</p>
<p>141 MB</p>
</td>
</tr>
<tr class="row-even"><td><p>Serialized objects</p></td>
<td><p>atp_data.pickle.gz</p>
<p>atp_data.Rdata</p>
</td>
<td><p>9.9 MB</p>
<p>22 MB</p>
</td>
</tr>
<tr class="row-odd"><td><p>Feather</p></td>
<td><p>atp_data_python.feather</p>
<p>atp_data_r.feather</p>
</td>
<td><p>47  MB</p>
<p>33 MB</p>
</td>
</tr>
<tr class="row-even"><td><p>Parquet</p></td>
<td><p>atp_data_python.parquet</p>
<p>atp_data_r.parquet</p>
</td>
<td><p>20  MB</p>
<p>12 MB</p>
</td>
</tr>
<tr class="row-odd"><td><p>HDF5</p></td>
<td><p>atp_data_python.h5</p>
<p>atp_data_r.h5</p>
</td>
<td><p>157 MB</p>
<p>82 MB</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="other-data-formats">
<h2>Other data formats<a class="headerlink" href="#other-data-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="excel-spreadsheets">
<h3>Excel spreadsheets<a class="headerlink" href="#excel-spreadsheets" title="Permalink to this headline">¶</a></h3>
<p>Excel spreadsheets are often used in companies and economics to display and
share data.</p>
<p><strong>Pros:</strong></p>
<ol class="arabic simple">
<li><p>Easy for beginners.</p></li>
<li><p>Easy to do simple operations for rows and columns.</p></li>
</ol>
<p><strong>Cons:</strong></p>
<ol class="arabic simple">
<li><p>Very space ineffective.</p></li>
<li><p>Slow.</p></li>
<li><p>Hard to do complicated analysis.</p></li>
<li><p>Many proprietary features make sharing harder.</p></li>
</ol>
<p>Let’s load Frasier Institutes
<a class="reference external" href="https://www.fraserinstitute.org/economic-freedom/dataset">Economic Freedom of the World-dataset</a>,
which is provided as an Excel spreadsheet.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-24-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-24-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-24-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html">pandas.read_excel</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">efw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;../data/efw.xlsx&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s1">&#39;B:BU&#39;</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4050</span><span class="p">)</span>
<span class="n">efw</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">Year</span>    <span class="n">ISO_Code</span>        <span class="n">Countries</span>       <span class="n">Economic</span> <span class="n">Freedom</span> <span class="n">Summary</span> <span class="n">Index</span>  <span class="n">Rank</span>    <span class="n">Quartile</span>        <span class="n">Government</span> <span class="n">consumption</span>  <span class="n">data</span>    <span class="n">Transfers</span> <span class="ow">and</span> <span class="n">subsidies</span>         <span class="n">data</span><span class="o">.</span><span class="mi">1</span>  <span class="o">...</span>     <span class="n">Conscription</span>    <span class="n">Labor</span> <span class="n">market</span> <span class="n">regulations</span>        <span class="n">Administrative</span> <span class="n">requirements</span>     <span class="n">Regulatory</span> <span class="n">Burden</span>       <span class="n">Starting</span> <span class="n">a</span> <span class="n">business</span>     <span class="n">Impartial</span> <span class="n">Public</span> <span class="n">Administration</span>         <span class="n">Licensing</span> <span class="n">restrictions</span>  <span class="n">Tax</span> <span class="n">compliance</span>  <span class="n">Business</span> <span class="n">regulations</span>    <span class="n">Regulation</span>
<span class="mi">0</span>       <span class="mi">2018</span>    <span class="n">ALB</span>     <span class="n">Albania</span>         <span class="mf">7.80</span>    <span class="mf">26.0</span>    <span class="mf">1.0</span>     <span class="mf">8.155882</span>        <span class="mf">12.270000</span>       <span class="mf">6.738420</span>        <span class="mf">12.470000</span>       <span class="o">...</span>     <span class="mf">10.0</span>    <span class="mf">6.717929</span>        <span class="mf">5.651538</span>        <span class="mf">6.666667</span>        <span class="mf">9.742477</span>        <span class="mf">5.396</span>   <span class="mf">5.621940</span>        <span class="mf">7.175250</span>        <span class="mf">6.708979</span>        <span class="mf">7.721734</span>
<span class="mi">1</span>       <span class="mi">2018</span>    <span class="n">DZA</span>     <span class="n">Algeria</span>         <span class="mf">4.97</span>    <span class="mf">157.0</span>   <span class="mf">4.0</span>     <span class="mf">3.220588</span>        <span class="mf">29.050000</span>       <span class="mf">7.817129</span>        <span class="mf">8.511137</span>        <span class="o">...</span>     <span class="mf">3.0</span>     <span class="mf">5.645397</span>        <span class="mf">4.215154</span>        <span class="mf">2.444444</span>        <span class="mf">9.305002</span>        <span class="mf">3.906</span>   <span class="mf">8.771111</span>        <span class="mf">7.029528</span>        <span class="mf">5.945207</span>        <span class="mf">5.563704</span>
<span class="mi">2</span>       <span class="mi">2018</span>    <span class="n">AGO</span>     <span class="n">Angola</span>  <span class="mf">4.75</span>    <span class="mf">159.0</span>   <span class="mf">4.0</span>     <span class="mf">7.698695</span>        <span class="mf">13.824437</span>       <span class="mf">9.623978</span>        <span class="mf">1.880000</span>        <span class="o">...</span>     <span class="mf">0.0</span>     <span class="mf">5.338186</span>        <span class="mf">2.937894</span>        <span class="mf">2.444444</span>        <span class="mf">8.730805</span>        <span class="mf">5.044</span>   <span class="mf">7.916416</span>        <span class="mf">6.782923</span>        <span class="mf">5.642747</span>        <span class="mf">5.386200</span>
<span class="mi">3</span>       <span class="mi">2018</span>    <span class="n">ARG</span>     <span class="n">Argentina</span>       <span class="mf">5.78</span>    <span class="mf">144.0</span>   <span class="mf">4.0</span>     <span class="mf">5.938235</span>        <span class="mf">19.810000</span>       <span class="mf">6.307902</span>        <span class="mf">14.050000</span>       <span class="o">...</span>     <span class="mf">10.0</span>    <span class="mf">5.119549</span>        <span class="mf">2.714233</span>        <span class="mf">6.666667</span>        <span class="mf">9.579288</span>        <span class="mf">7.202</span>   <span class="mf">5.726521</span>        <span class="mf">6.508295</span>        <span class="mf">6.399500</span>        <span class="mf">5.757401</span>
<span class="mi">4</span>       <span class="mi">2018</span>    <span class="n">ARM</span>     <span class="n">Armenia</span>         <span class="mf">7.92</span>    <span class="mf">18.0</span>    <span class="mf">1.0</span>     <span class="mf">7.717647</span>        <span class="mf">13.760000</span>       <span class="mf">7.711172</span>        <span class="mf">8.900000</span>        <span class="o">...</span>     <span class="mf">0.0</span>     <span class="mf">6.461113</span>        <span class="mf">5.170406</span>        <span class="mf">6.000000</span>        <span class="mf">9.863530</span>        <span class="mf">6.298</span>   <span class="mf">9.302574</span>        <span class="mf">7.040738</span>        <span class="mf">7.279208</span>        <span class="mf">7.762321</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-24-1 docutils container">
<p><a class="reference external" href="https://readxl.tidyverse.org/reference/read_excel.html">Tidyverse’s read_excel</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span>
<span class="n">efw</span> <span class="o">&lt;-</span> <span class="nf">read_excel</span><span class="p">(</span><span class="s">&#39;../data/efw.xlsx&#39;</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">range</span><span class="o">=</span><span class="s">&#39;B5:BU4055&#39;</span><span class="p">)</span>

 <span class="n">Year</span>   <span class="n">ISO_Code</span>        <span class="n">Countries</span>       <span class="n">Economic</span> <span class="n">Freedom</span> <span class="n">Summary</span> <span class="n">Index</span>  <span class="n">Rank</span>    <span class="n">Quartile</span>        <span class="n">Government</span> <span class="n">consumption</span>  <span class="n">data...8</span>        <span class="n">Transfers</span> <span class="n">and</span> <span class="n">subsidies</span> <span class="n">data...10</span>       <span class="kc">...</span>     <span class="n">Conscription</span>    <span class="n">Labor</span> <span class="n">market</span> <span class="n">regulations</span>        <span class="n">Administrative</span> <span class="n">requirements</span>     <span class="n">Regulatory</span> <span class="n">Burden</span>       <span class="n">Starting</span> <span class="n">a</span> <span class="n">business</span>     <span class="n">Impartial</span> <span class="n">Public</span> <span class="n">Administration</span> <span class="n">Licensing</span> <span class="n">restrictions</span>  <span class="n">Tax</span> <span class="n">compliance</span>  <span class="n">Business</span> <span class="n">regulations</span>    <span class="n">Regulation</span>
<span class="m">2018</span>    <span class="n">ALB</span>     <span class="n">Albania</span>         <span class="m">7.80</span>    <span class="m">26</span>      <span class="m">1</span>       <span class="m">8.155882</span>        <span class="m">12.27000</span>        <span class="m">6.738420</span>        <span class="m">12.470000</span>       <span class="kc">...</span>     <span class="m">10</span>      <span class="m">6.717929</span>        <span class="m">5.651538</span>        <span class="m">6.666667</span>        <span class="m">9.742477</span>        <span class="m">5.396</span>   <span class="m">5.621940</span>        <span class="m">7.175250</span>        <span class="m">6.708979</span>        <span class="m">7.721734</span>
<span class="m">2018</span>    <span class="n">DZA</span>     <span class="n">Algeria</span>         <span class="m">4.97</span>    <span class="m">157</span>     <span class="m">4</span>       <span class="m">3.220588</span>        <span class="m">29.05000</span>        <span class="m">7.817129</span>        <span class="m">8.511137</span>        <span class="kc">...</span>     <span class="m">3</span>       <span class="m">5.645397</span>        <span class="m">4.215154</span>        <span class="m">2.444444</span>        <span class="m">9.305002</span>        <span class="m">3.906</span>   <span class="m">8.771111</span>        <span class="m">7.029528</span>        <span class="m">5.945207</span>        <span class="m">5.563704</span>
<span class="m">2018</span>    <span class="n">AGO</span>     <span class="n">Angola</span>  <span class="m">4.75</span>    <span class="m">159</span>     <span class="m">4</span>       <span class="m">7.698695</span>        <span class="m">13.82444</span>        <span class="m">9.623978</span>        <span class="m">1.880000</span>        <span class="kc">...</span>     <span class="m">0</span>       <span class="m">5.338186</span>        <span class="m">2.937894</span>        <span class="m">2.444444</span>        <span class="m">8.730805</span>        <span class="m">5.044</span>   <span class="m">7.916416</span>        <span class="m">6.782923</span>        <span class="m">5.642747</span>        <span class="m">5.386200</span>
<span class="m">2018</span>    <span class="n">ARG</span>     <span class="n">Argentina</span>       <span class="m">5.78</span>    <span class="m">144</span>     <span class="m">4</span>       <span class="m">5.938235</span>        <span class="m">19.81000</span>        <span class="m">6.307902</span>        <span class="m">14.050000</span>       <span class="kc">...</span>     <span class="m">10</span>      <span class="m">5.119549</span>        <span class="m">2.714233</span>        <span class="m">6.666667</span>        <span class="m">9.579288</span>        <span class="m">7.202</span>   <span class="m">5.726521</span>        <span class="m">6.508295</span>        <span class="m">6.399500</span>        <span class="m">5.757401</span>
<span class="m">2018</span>    <span class="n">ARM</span>     <span class="n">Armenia</span>         <span class="m">7.92</span>    <span class="m">18</span>      <span class="m">1</span>       <span class="m">7.717647</span>        <span class="m">13.76000</span>        <span class="m">7.711172</span>        <span class="m">8.900000</span>        <span class="kc">...</span>     <span class="m">0</span>       <span class="m">6.461113</span>        <span class="m">5.170406</span>        <span class="m">6.000000</span>        <span class="m">9.863530</span>        <span class="m">6.298</span>   <span class="m">9.302574</span>        <span class="m">7.040738</span>        <span class="m">7.279208</span>        <span class="m">7.762321</span>
<span class="m">2018</span>    <span class="n">AUS</span>     <span class="n">Australia</span>       <span class="m">8.23</span>    <span class="m">5</span>       <span class="m">1</span>       <span class="m">4.450000</span>        <span class="m">24.87000</span>        <span class="m">6.867958</span>        <span class="m">11.994595</span>       <span class="kc">...</span>     <span class="m">10</span>      <span class="m">7.803349</span>        <span class="m">3.981758</span>        <span class="m">8.888889</span>        <span class="m">9.928614</span>        <span class="m">10.000</span>  <span class="m">8.953087</span>        <span class="m">8.823021</span>        <span class="m">8.429228</span>        <span class="m">8.726281</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sql-databases">
<h3>SQL databases<a class="headerlink" href="#sql-databases" title="Permalink to this headline">¶</a></h3>
<p>SQL databases are often used in industry, especially for storing transactions.
Compared to R and Pandas, most SQL databases are row-oriented, which changes
many aspect of a data pipeline.</p>
<p>Row oriented databases have the following features:</p>
<ul class="simple">
<li><p>Adding new observations (rows) is cheap. Thus adding new transactions,
results etc. does not have the same performance penalty as appending into
a column oriented dataset.</p></li>
<li><p>Adding new columns is expensive. Doing joins between databases can be very
complicated.</p></li>
<li><p>Columns usually cannot be cast to new types. One usually needs to specify
the column specification before adding rows.</p></li>
<li><p>For big databases doing queries in a correct order is very important. Queries
are usually also fully determined by pre-compiling them before they are
executed to allow the database to minimize the amount of data that needs
to be accessed.</p></li>
</ul>
<p>These features mean that SQL databases are good when you have constant flow
of data that has a pre-determined data format and you know how to access them
using pre-compiled SQL queries.</p>
<p>There are plenty of different SQL databases and for this reason there are
libraries that allow for simpler connections for many different databases.</p>
<p>Let’s save <code class="docutils literal notranslate"><span class="pre">atp_players</span></code> into a`SQLite &lt;<a class="reference external" href="https://www.sqlite.org/index.html">https://www.sqlite.org/index.html</a>&gt;`_
database.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-25-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-25-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-25-0 active docutils container">
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_sql.html">pandas.DataFrame.to_sql</a></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_sql.html">pandas.read_sql</a></p>
<p><a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/engines.html">SQLAlchemy’s create_engine</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///../data/atp_players_python.sqlite&#39;</span><span class="p">)</span>

<span class="n">atp_players</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;atp_players&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s1">&#39;atp_players&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>

<span class="n">index</span>   <span class="n">player_id</span>       <span class="n">hand</span>    <span class="n">birth_date</span>      <span class="n">country_code</span>    <span class="n">name</span>
<span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">100001</span>  <span class="n">R</span>       <span class="mi">1913</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">22</span>      <span class="n">USA</span>     <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>
<span class="mi">1</span>       <span class="mi">1</span>       <span class="mi">100002</span>  <span class="n">R</span>       <span class="mi">1921</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">20</span>      <span class="n">ECU</span>     <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>
<span class="mi">2</span>       <span class="mi">2</span>       <span class="mi">100003</span>  <span class="n">R</span>       <span class="mi">1927</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>      <span class="n">AUS</span>     <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>
<span class="mi">3</span>       <span class="mi">3</span>       <span class="mi">100004</span>  <span class="n">R</span>       <span class="mi">1927</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span>      <span class="n">ITA</span>     <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>
<span class="mi">4</span>       <span class="mi">4</span>       <span class="mi">100005</span>  <span class="n">R</span>       <span class="mi">1928</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">09</span>      <span class="n">USA</span>     <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span>
<span class="o">...</span>     <span class="o">...</span>     <span class="o">...</span>     <span class="o">...</span>     <span class="o">...</span>     <span class="o">...</span>     <span class="o">...</span>
<span class="mi">54933</span>   <span class="mi">54933</span>   <span class="mi">209899</span>  <span class="n">U</span>       <span class="n">NaT</span>     <span class="n">RUS</span>     <span class="n">Simakin</span><span class="p">,</span> <span class="n">Ilia</span>
<span class="mi">54934</span>   <span class="mi">54934</span>   <span class="mi">209900</span>  <span class="n">U</span>       <span class="n">NaT</span>     <span class="n">RUS</span>     <span class="n">Galimardanov</span><span class="p">,</span> <span class="n">Oscar</span>
<span class="mi">54935</span>   <span class="mi">54935</span>   <span class="mi">209901</span>  <span class="n">U</span>       <span class="n">NaT</span>     <span class="n">RUS</span>     <span class="n">Stepin</span><span class="p">,</span> <span class="n">Alexander</span>
<span class="mi">54936</span>   <span class="mi">54936</span>   <span class="mi">209902</span>  <span class="n">U</span>       <span class="n">NaT</span>     <span class="n">RUS</span>     <span class="n">Trunov</span><span class="p">,</span> <span class="n">Igor</span>
<span class="mi">54937</span>   <span class="mi">54937</span>   <span class="mi">209903</span>  <span class="n">U</span>       <span class="n">NaT</span>     <span class="n">AUT</span>     <span class="n">Neumayer</span><span class="p">,</span> <span class="n">Lukas</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-25-1 docutils container">
<p><a class="reference external" href="https://dbi.r-dbi.org/reference/dbconnect">DBI’s dbConnect</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">DBI</span><span class="p">)</span>
<span class="n">con</span> <span class="o">&lt;-</span> <span class="n">DBI</span><span class="o">::</span><span class="nf">dbConnect</span><span class="p">(</span><span class="n">RSQLite</span><span class="o">::</span><span class="nf">SQLite</span><span class="p">(),</span> <span class="n">dbname</span> <span class="o">=</span> <span class="s">&quot;../data/atp_players_r.sqlite&quot;</span><span class="p">)</span>
<span class="nf">copy_to</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">atp_players</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">temporary</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">dbDisconnect</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

<span class="n">con</span> <span class="o">&lt;-</span> <span class="n">DBI</span><span class="o">::</span><span class="nf">dbConnect</span><span class="p">(</span><span class="n">RSQLite</span><span class="o">::</span><span class="nf">SQLite</span><span class="p">(),</span> <span class="n">dbname</span> <span class="o">=</span> <span class="s">&quot;../data/atp_players_r.sqlite&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">tbl</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="s">&#39;atp_players&#39;</span><span class="p">))</span>
<span class="nf">dbDisconnect</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

<span class="c1"># Source:   table&lt;atp_players&gt; [?? x 5]</span>
<span class="c1"># Database: sqlite 3.22.0</span>
<span class="c1">#   [../data/atp_players_r.sqlite]</span>
   <span class="n">player_id</span> <span class="n">name</span>                     <span class="n">hand</span>   <span class="n">birth_date</span> <span class="n">country_code</span>
       <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>                    <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>       <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>
 <span class="m">1</span>    <span class="m">100001</span> <span class="n">Mulloy</span><span class="p">,</span> <span class="n">Gardnar</span>          <span class="n">R</span>     <span class="m">-1770681600</span> <span class="n">USA</span>
 <span class="m">2</span>    <span class="m">100002</span> <span class="n">Segura</span><span class="p">,</span> <span class="n">Pancho</span>           <span class="n">R</span>     <span class="m">-1531612800</span> <span class="n">ECU</span>
 <span class="m">3</span>    <span class="m">100003</span> <span class="n">Sedgman</span><span class="p">,</span> <span class="n">Frank</span>           <span class="n">R</span>     <span class="m">-1333324800</span> <span class="n">AUS</span>
 <span class="m">4</span>    <span class="m">100004</span> <span class="n">Merlo</span><span class="p">,</span> <span class="n">Giuseppe</span>          <span class="n">R</span>     <span class="m">-1332547200</span> <span class="n">ITA</span>
 <span class="m">5</span>    <span class="m">100005</span> <span class="n">Gonzales</span><span class="p">,</span> <span class="n">Richard</span> <span class="n">Pancho</span> <span class="n">R</span>     <span class="m">-1314316800</span> <span class="n">USA</span>
 <span class="m">6</span>    <span class="m">100006</span> <span class="n">Golden</span><span class="p">,</span> <span class="n">Grant</span>            <span class="n">R</span>     <span class="m">-1273795200</span> <span class="n">USA</span>
 <span class="m">7</span>    <span class="m">100007</span> <span class="n">Segal</span><span class="p">,</span> <span class="n">Abe</span>               <span class="n">L</span>     <span class="m">-1236816000</span> <span class="n">RSA</span>
 <span class="m">8</span>    <span class="m">100008</span> <span class="n">Nielsen</span><span class="p">,</span> <span class="n">Kurt</span>            <span class="n">R</span>     <span class="m">-1234483200</span> <span class="n">DEN</span>
 <span class="m">9</span>    <span class="m">100009</span> <span class="n">Gulyas</span><span class="p">,</span> <span class="n">Istvan</span>           <span class="n">R</span>     <span class="m">-1206057600</span> <span class="n">HUN</span>
<span class="m">10</span>    <span class="m">100010</span> <span class="n">Ayala</span><span class="p">,</span> <span class="n">Luis</span>              <span class="n">R</span>     <span class="m">-1176681600</span> <span class="n">CHI</span>
<span class="c1"># … with more rows</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../chapter-3-modeling/" class="btn btn-neutral float-right" title="Chapter 3: Modeling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../chapter-1-understanding/" class="btn btn-neutral float-left" title="Chapter 1: Understanding data analysis workflows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Aalto SciComp

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>