

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 3: Modeling &mdash; Data analysis workflows with R and Python  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mystnb.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script src="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
        <script src="../_static/sphinx_tabs/tabs.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Chapter 4: Scaling" href="../chapter-4-scaling/" />
    <link rel="prev" title="Chapter 2: Data preparation" href="../chapter-2-data/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../" class="icon icon-home" alt="Documentation Home"> Data analysis workflows with R and Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course lessons</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chapter-1-understanding/">Chapter 1: Understanding data analysis workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-2-data/">Chapter 2: Data preparation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 3: Modeling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#types-of-modeling">Types of modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#grouping-data-by-a-common-variable">Grouping data by a common variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description-of-data-triton-cluster-file-statistics">Description of data - Triton cluster file statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-groupings-and-summaries-calculating-new-files-per-year">Simple groupings and summaries - Calculating new files per year</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-function-for-many-different-summaries">Creating a function for many different summaries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#curve-fitting-fitting-functions-into-data">Curve fitting - Fitting functions into data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#determining-the-growth-rate-of-file-space-usage">Determining the growth rate of file space usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitting-a-linear-model">Fitting a linear model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-bootstrapping-resampling-methods-for-the-calculation-of-statistical-moments">Using bootstrapping/resampling methods for the calculation of statistical moments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quick-overview-of-bootstrapping">Quick overview of bootstrapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-nested-dataframes-to-help-with-bootstrapping">Using nested dataframes to help with bootstrapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-4-scaling/">Chapter 4: Scaling</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Data analysis workflows with R and Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
        
      <li>Chapter 3: Modeling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/AaltoSciComp/data-analysis-workflows-course/blob/master/lectures/chapter-3-modeling.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-3-modeling">
<h1>Chapter 3: Modeling<a class="headerlink" href="#chapter-3-modeling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="types-of-modeling">
<h2>Types of modeling<a class="headerlink" href="#types-of-modeling" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we will focus on doing modeling on our datasets. In our case
the term “modeling” refers to any activity that takes in our data and produces
a result. We’ll be doing three differing types of modeling:</p>
<ol class="arabic simple">
<li><p>Creating summaries of our data by calculating statistics
(e.g. mean, variance).</p></li>
<li><p>Fitting a function into our data.</p></li>
<li><p>Using bootstrapping methods to calculate statistical moments.</p></li>
</ol>
<p>To accomplish these task, we’ll be using various features of our frameworks:</p>
<ol class="arabic simple">
<li><p>Groupings - Grouping data by a common variable for efficient summaries and
plotting.</p></li>
<li><p>Apply- and map-functions - Functions that run a function for all rows of
our data structure.</p></li>
<li><p>Nesting/stacking - Storing data frames in our data frames.</p></li>
</ol>
</div>
<div class="section" id="grouping-data-by-a-common-variable">
<h2>Grouping data by a common variable<a class="headerlink" href="#grouping-data-by-a-common-variable" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description-of-data-triton-cluster-file-statistics">
<h3>Description of data - Triton cluster file statistics<a class="headerlink" href="#description-of-data-triton-cluster-file-statistics" title="Permalink to this headline">¶</a></h3>
<p>In grouping one determines one or more variables to use as grouping index and
then these indices are used to apply some function to each subgroup. They are
especially useful when one is calculating some statistics from each subgroup,
doing multiple plots or determining plot colors.</p>
<p>This can be visualized in the following way:</p>
<img alt="../_images/dataframe-grouped.svg" src="../_images/dataframe-grouped.svg" /><p>Let’s consider the dataset presented below. It is contains the number of files
stored on Aalto University’s Triton cluster’s file system. Columns are:</p>
<ul class="simple">
<li><p>File size rounded down to the nearest exponent of 2 (e.g. 3 MB file would
be counted to row with size 2097152 (2^21 = 2097152))</p></li>
<li><p>File modification date in months before 31.12.2020 (e.g. file written in
3.9.2020 would be 3)</p></li>
<li><p>Number of files</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_filesizes</span><span class="p">(</span><span class="n">filesizes_file</span><span class="p">):</span>
    <span class="n">filesizes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">filesizes_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span><span class="s1">&#39;MonthsTo2021&#39;</span><span class="p">,</span> <span class="s1">&#39;Files&#39;</span><span class="p">])</span>

    <span class="c1"># Remove empty files</span>
    <span class="n">filesizes</span> <span class="o">=</span> <span class="n">filesizes</span><span class="p">[</span><span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Bytes&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Create a column for log2 of bytes</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Bytes&#39;</span><span class="p">])</span>
    <span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="c1"># Determine total space S used by N files of size X during date D: S=N*X</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Bytes&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Files&#39;</span><span class="p">]</span>
    <span class="c1"># Determine file year and month from the MonthsTo2021-column</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;TotalMonths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2021</span><span class="o">*</span><span class="mi">12</span> <span class="o">-</span> <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;MonthsTo2021&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;TotalMonths&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">12</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;TotalMonths&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set year for really old files and files with incorrect timestamps</span>
    <span class="n">invalid_years</span> <span class="o">=</span> <span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2010</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2020</span><span class="p">)</span>
    <span class="n">filesizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">invalid_years</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;Month&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="c1"># Get month names for the correct ordering of Month categories</span>
    <span class="n">month_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2000-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">month_name</span><span class="p">()</span>
    <span class="c1"># Create Date</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">]])</span>
    <span class="c1"># Set Month</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month_name</span><span class="p">(),</span> <span class="n">categories</span><span class="o">=</span><span class="n">month_names</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Set Month to be an ordered categorical with predefined levels</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">month_names</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Sort data based on Date and BytesLog2</span>
    <span class="n">filesizes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Remove old columns</span>
    <span class="n">filesizes</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;MonthsTo2021&#39;</span><span class="p">,</span><span class="s1">&#39;TotalMonths&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filesizes</span>

<span class="n">filesizes</span> <span class="o">=</span> <span class="n">load_filesizes</span><span class="p">(</span><span class="s1">&#39;../data/filesizes_timestamps.txt&#39;</span><span class="p">)</span>
<span class="n">filesizes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">Bytes</span>   <span class="n">Files</span>   <span class="n">BytesLog2</span>       <span class="n">SpaceUsage</span>      <span class="n">Year</span>    <span class="n">Month</span>   <span class="n">Date</span>
<span class="mi">287</span>     <span class="mi">1</span>       <span class="mi">5</span>       <span class="mi">0</span>       <span class="mi">5</span>       <span class="mf">2010.0</span>  <span class="n">January</span>         <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">451</span>     <span class="mi">2</span>       <span class="mi">3</span>       <span class="mi">1</span>       <span class="mi">6</span>       <span class="mf">2010.0</span>  <span class="n">January</span>         <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">627</span>     <span class="mi">4</span>       <span class="mi">27</span>      <span class="mi">2</span>       <span class="mi">108</span>     <span class="mf">2010.0</span>  <span class="n">January</span>         <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">822</span>     <span class="mi">8</span>       <span class="mi">136</span>     <span class="mi">3</span>       <span class="mi">1088</span>    <span class="mf">2010.0</span>  <span class="n">January</span>         <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1057</span>    <span class="mi">16</span>      <span class="mi">208</span>     <span class="mi">4</span>       <span class="mi">3328</span>    <span class="mf">2010.0</span>  <span class="n">January</span>         <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">load_filesizes</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">filesizes_file</span><span class="p">){</span>
    <span class="n">filesizes</span> <span class="o">&lt;-</span> <span class="nf">read_table2</span><span class="p">(</span><span class="n">filesizes_file</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;Bytes&#39;</span><span class="p">,</span><span class="s">&#39;MonthsTo2021&#39;</span><span class="p">,</span> <span class="s">&#39;Files&#39;</span><span class="p">))</span>

    <span class="n">filesizes</span> <span class="o">&lt;-</span> <span class="n">filesizes</span> <span class="o">%&gt;%</span>
        <span class="c1"># Remove empty files</span>
        <span class="nf">filter</span><span class="p">(</span><span class="n">Bytes</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="c1"># Create a column for log2 of bytes</span>
        <span class="nf">mutate</span><span class="p">(</span><span class="n">BytesLog2</span> <span class="o">=</span> <span class="nf">log2</span><span class="p">(</span><span class="n">Bytes</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="c1"># Determine total space S used by N files of size X during date D: S=N*X</span>
        <span class="nf">mutate</span><span class="p">(</span><span class="n">SpaceUsage</span> <span class="o">=</span> <span class="n">Bytes</span><span class="o">*</span><span class="n">Files</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="c1"># Determine file year and month from the MonthsTo2021-column</span>
        <span class="nf">mutate</span><span class="p">(</span>
            <span class="n">TotalMonths</span> <span class="o">=</span> <span class="m">2021</span><span class="o">*</span><span class="m">12</span> <span class="o">-</span> <span class="n">MonthsTo2021</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
            <span class="n">Year</span> <span class="o">=</span> <span class="n">TotalMonths</span> <span class="o">%/%</span> <span class="m">12</span><span class="p">,</span>
            <span class="n">Month</span> <span class="o">=</span> <span class="n">TotalMonths</span> <span class="o">%%</span> <span class="m">12</span> <span class="m">+1</span><span class="p">,</span>
            <span class="n">Day</span> <span class="o">=</span> <span class="m">1</span>
        <span class="p">)</span>

     <span class="c1"># Set year for really old files and files with incorrect timestamps</span>
    <span class="n">invalid_years</span> <span class="o">=</span> <span class="nf">c</span><span class="p">((</span><span class="n">filesizes</span><span class="p">[</span><span class="s">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">2010</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="s">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="m">2020</span><span class="p">))</span>
    <span class="n">filesizes</span><span class="p">[</span><span class="n">invalid_years</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">,</span><span class="s">&#39;Month&#39;</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="kc">NaN</span>

    <span class="c1"># Get month names for the correct ordering of Month categories</span>
    <span class="n">month_names</span> <span class="o">&lt;-</span> <span class="nf">month</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">12</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="s">&#39;C&#39;</span><span class="p">)</span>
    <span class="n">filesizes</span> <span class="o">&lt;-</span> <span class="n">filesizes</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate</span><span class="p">(</span>
            <span class="c1"># Create Date and get the name for the month</span>
            <span class="n">Date</span> <span class="o">=</span> <span class="nf">make_datetime</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Month</span><span class="p">,</span> <span class="n">Day</span><span class="p">),</span>
            <span class="c1"># Set Month</span>
            <span class="n">Month</span><span class="o">=</span><span class="nf">month</span><span class="p">(</span><span class="n">Month</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="s">&#39;C&#39;</span><span class="p">),</span>
            <span class="c1"># Set Month to be an ordered categorical with predefined levels</span>
            <span class="n">Month</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">Month</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">month_names</span><span class="p">))</span>
    <span class="n">filesizes</span> <span class="o">&lt;-</span> <span class="n">filesizes</span> <span class="o">%&gt;%</span>
        <span class="c1"># Sort data based on Date and BytesLog2</span>
        <span class="nf">arrange</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span> <span class="n">BytesLog2</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="c1"># Remove old columns</span>
        <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">MonthsTo2021</span><span class="p">,</span><span class="o">-</span><span class="n">TotalMonths</span><span class="p">,</span><span class="o">-</span><span class="n">Day</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">filesizes</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">filesizes</span> <span class="o">&lt;-</span> <span class="nf">load_filesizes</span><span class="p">(</span><span class="s">&#39;../data/filesizes_timestamps.txt&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">filesizes</span><span class="p">)</span>

<span class="n">Parsed</span> <span class="n">with</span> <span class="n">column</span> <span class="n">specification</span><span class="o">:</span>
<span class="nf">cols</span><span class="p">(</span>
  <span class="n">Bytes</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">MonthsTo2021</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">(),</span>
  <span class="n">Files</span> <span class="o">=</span> <span class="nf">col_double</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">A</span> <span class="n">tibble</span><span class="o">:</span> <span class="m">6</span> × <span class="m">7</span> <span class="n">Bytes</span>   <span class="n">Files</span>   <span class="n">BytesLog2</span>       <span class="n">SpaceUsage</span>      <span class="n">Year</span>    <span class="n">Month</span>   <span class="n">Date</span>
<span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">ord</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dttm</span><span class="o">&gt;</span>
<span class="m">1</span>       <span class="m">5</span>       <span class="m">0</span>       <span class="m">5</span>       <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
<span class="m">2</span>       <span class="m">3</span>       <span class="m">1</span>       <span class="m">6</span>       <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
<span class="m">4</span>       <span class="m">27</span>      <span class="m">2</span>       <span class="m">108</span>     <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
<span class="m">8</span>       <span class="m">136</span>     <span class="m">3</span>       <span class="m">1088</span>    <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
<span class="m">16</span>      <span class="m">208</span>     <span class="m">4</span>       <span class="m">3328</span>    <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
<span class="m">32</span>      <span class="m">653</span>     <span class="m">5</span>       <span class="m">20896</span>   <span class="m">2010</span>    <span class="n">Jan</span>     <span class="m">2010-01-01</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="simple-groupings-and-summaries-calculating-new-files-per-year">
<h3>Simple groupings and summaries - Calculating new files per year<a class="headerlink" href="#simple-groupings-and-summaries-calculating-new-files-per-year" title="Permalink to this headline">¶</a></h3>
<p>Summaries are usually statistics that are calculated on some (or all) columns
based on some grouping. Typical summarys include calculating mean, variance and
covariance. It is important to note that summaries are done with respect to
some axis of our dataset. Typically they are done column-wise as that is the
recommended direction for observations. They also reduce the size of our
dataset.</p>
<p>Summaries can be visualized in the following way:</p>
<img alt="../_images/dataframe-summary.svg" src="../_images/dataframe-summary.svg" /><p>Our parsed file contains columns for date, year, month, month name, the size of
files in two different formats, the number of files and the total space used by
the files. Let’s say we’re interested in the how the number of file has
increased each year. To do this, we’ll first limit our focus on the relevant
columns.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-1-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-1-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop rows with NaNs (invalid years)</span>
<span class="n">newfiles_relevant</span> <span class="o">=</span> <span class="n">filesizes</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Pick relevant columns</span>
<span class="n">newfiles_relevant</span> <span class="o">=</span> <span class="n">newfiles_relevant</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;Files&#39;</span><span class="p">]]</span>
<span class="n">newfiles_relevant</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">Year</span>    <span class="n">Files</span>
<span class="mi">287</span>     <span class="mf">2010.0</span>  <span class="mi">5</span>
<span class="mi">451</span>     <span class="mf">2010.0</span>  <span class="mi">3</span>
<span class="mi">627</span>     <span class="mf">2010.0</span>  <span class="mi">27</span>
<span class="mi">822</span>     <span class="mf">2010.0</span>  <span class="mi">136</span>
<span class="mi">1057</span>    <span class="mf">2010.0</span>  <span class="mi">208</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">newfiles_relevant</span> <span class="o">&lt;-</span> <span class="n">filesizes</span> <span class="o">%&gt;%</span>
    <span class="c1"># Drop rows with NaNs (invalid years)</span>
    <span class="nf">drop_na</span><span class="p">()</span> <span class="o">%&gt;%</span>
    <span class="c1"># Pick relevant columns</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Files</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="c1"># Change year to category for prettier plotting</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">Year</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">Year</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">newfiles_relevant</span><span class="p">)</span>

 <span class="n">A</span> <span class="n">tibble</span><span class="o">:</span> <span class="m">6</span> × <span class="m">2</span> <span class="n">Year</span>   <span class="n">Files</span>
<span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">2010</span>    <span class="m">5</span>
<span class="m">2010</span>    <span class="m">3</span>
<span class="m">2010</span>    <span class="m">27</span>
<span class="m">2010</span>    <span class="m">136</span>
<span class="m">2010</span>    <span class="m">208</span>
<span class="m">2010</span>    <span class="m">653</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll want to group our data based on the year-column (<code class="docutils literal notranslate"><span class="pre">Year</span></code>) and
calculate the total number of files (<code class="docutils literal notranslate"><span class="pre">Files</span></code>) across all rows (all dates
and files sizes).</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-2-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-2-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">newfiles_relevant</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">newfiles_yearly_sum</span> <span class="o">=</span> <span class="n">newfiles_relevant</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">newfiles_yearly_sum</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">newfiles_yearly_sum</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="p">(</span><span class="mi">4698</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">Files</span>
<span class="n">Year</span>
<span class="mf">2010.0</span>  <span class="mi">5590287</span>
<span class="mf">2011.0</span>  <span class="mi">13197038</span>
<span class="mf">2012.0</span>  <span class="mi">17099900</span>
<span class="mf">2013.0</span>  <span class="mi">14755151</span>
<span class="mf">2014.0</span>  <span class="mi">26329321</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">glimpse</span><span class="p">(</span><span class="n">newfiles_relevant</span><span class="p">)</span>

<span class="n">newfiles_yearly_sum</span> <span class="o">&lt;-</span> <span class="n">newfiles_relevant</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">Files</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">Files</span><span class="p">))</span>

<span class="nf">glimpse</span><span class="p">(</span><span class="n">newfiles_yearly_sum</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">newfiles_yearly_sum</span><span class="p">)</span>

<span class="n">Year</span>    <span class="n">Files</span>
<span class="m">2010</span>    <span class="m">5590287</span>
<span class="m">2011</span>    <span class="m">13197038</span>
<span class="m">2012</span>    <span class="m">17099900</span>
<span class="m">2013</span>    <span class="m">14755151</span>
<span class="m">2014</span>    <span class="m">26329321</span>
<span class="m">2015</span>    <span class="m">24896331</span>
</pre></div>
</div>
</div>
</div>
<p>In Python we see that the output of
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html">agg</a>
is still grouped and for plotting, we’ll want
to reset the grouping. R
<a class="reference external" href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a>
removes the last layer of groupings, but let’s
verify that the data is ungrouped.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-3-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-3-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newfiles_yearly_sum</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">newfiles_yearly_sum</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">Year</span>    <span class="n">Files</span>
<span class="mi">0</span>       <span class="mf">2010.0</span>  <span class="mi">5590287</span>
<span class="mi">1</span>       <span class="mf">2011.0</span>  <span class="mi">13197038</span>
<span class="mi">2</span>       <span class="mf">2012.0</span>  <span class="mi">17099900</span>
<span class="mi">3</span>       <span class="mf">2013.0</span>  <span class="mi">14755151</span>
<span class="mi">4</span>       <span class="mf">2014.0</span>  <span class="mi">26329321</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">newfiles_yearly_sum</span> <span class="o">&lt;-</span> <span class="n">newfiles_yearly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ungroup</span><span class="p">()</span>

<span class="nf">head</span><span class="p">(</span><span class="n">newfiles_yearly_sum</span><span class="p">)</span>

 <span class="n">Year</span>   <span class="n">Files</span>
<span class="m">2010</span>    <span class="m">5590287</span>
<span class="m">2011</span>    <span class="m">13197038</span>
<span class="m">2012</span>    <span class="m">17099900</span>
<span class="m">2013</span>    <span class="m">14755151</span>
<span class="m">2014</span>    <span class="m">26329321</span>
<span class="m">2015</span>    <span class="m">24896331</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot this data in a bar plot:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-4-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-4-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newfiles_yearly_sum</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newfiles_yearly_sum</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">newfiles_yearly_sum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/newfiles_yearly_sum_python.svg" src="../_images/newfiles_yearly_sum_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="n">newfiles_yearly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/newfiles_yearly_sum_r.svg" src="../_images/newfiles_yearly_sum_r.svg" /></div>
</div>
</div>
<div class="section" id="creating-a-function-for-many-different-summaries">
<h3>Creating a function for many different summaries<a class="headerlink" href="#creating-a-function-for-many-different-summaries" title="Permalink to this headline">¶</a></h3>
<p>Let’s create a function for this workflow so that we can easily do similar
calculations with various different groups.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-5-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-5-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-5-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">groupings</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">):</span>
    <span class="c1"># Drop rows with NaNs (invalid years)</span>
    <span class="n">data_relevant</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Pick relevant columns</span>
    <span class="n">data_relevant</span> <span class="o">=</span> <span class="n">data_relevant</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">groupings</span> <span class="o">+</span> <span class="n">targets</span><span class="p">]</span>
    <span class="c1"># Change grouping to category for prettier plotting</span>
    <span class="n">data_relevant</span><span class="p">[</span><span class="n">groupings</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_relevant</span><span class="p">[</span><span class="n">groupings</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

    <span class="c1"># Aggregate data</span>
    <span class="n">data_aggregated</span> <span class="o">=</span> <span class="n">data_relevant</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groupings</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_function</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_aggregated</span>

<span class="n">newfiles_yearly_sum</span> <span class="o">=</span> <span class="n">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">],</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">newfiles_yearly_sum</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">Year</span>    <span class="n">Files</span>
<span class="mi">0</span>       <span class="mf">2010.0</span>  <span class="mi">5590287</span>
<span class="mi">1</span>       <span class="mf">2011.0</span>  <span class="mi">13197038</span>
<span class="mi">2</span>       <span class="mf">2012.0</span>  <span class="mi">17099900</span>
<span class="mi">3</span>       <span class="mf">2013.0</span>  <span class="mi">14755151</span>
<span class="mi">4</span>       <span class="mf">2014.0</span>  <span class="mi">26329321</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-5-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">aggregate_filesize_data</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data_relevant</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span>
        <span class="c1"># Drop rows with NaNs (invalid years)</span>
        <span class="nf">drop_na</span><span class="p">()</span> <span class="o">%&gt;%</span>
        <span class="c1"># Pick relevant columns</span>
        <span class="nf">select_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">grouping</span><span class="p">,</span> <span class="n">target</span><span class="p">)))</span> <span class="o">%&gt;%</span>
        <span class="c1"># Change grouping to category for prettier plotting</span>
        <span class="nf">mutate_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">grouping</span><span class="p">),</span> <span class="n">as.factor</span><span class="p">)</span>

    <span class="c1"># Aggregate data</span>
    <span class="n">data_aggregated</span> <span class="o">&lt;-</span> <span class="n">data_relevant</span> <span class="o">%&gt;%</span>
        <span class="nf">group_by_at</span><span class="p">((</span><span class="n">grouping</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="nf">summarize_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">agg_function</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="nf">ungroup</span><span class="p">()</span>

    <span class="nf">return</span><span class="p">(</span><span class="n">data_aggregated</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">newfiles_yearly_sum</span> <span class="o">&lt;-</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Files&#39;</span><span class="p">),</span> <span class="n">sum</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">newfiles_yearly_sum</span><span class="p">)</span>

 <span class="n">Year</span>   <span class="n">Files</span>
<span class="m">2010</span>    <span class="m">5590287</span>
<span class="m">2011</span>    <span class="m">13197038</span>
<span class="m">2012</span>    <span class="m">17099900</span>
<span class="m">2013</span>    <span class="m">14755151</span>
<span class="m">2014</span>    <span class="m">26329321</span>
<span class="m">2015</span>    <span class="m">24896331</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use this function to create the following plots:</p>
<ul class="simple">
<li><p>Yearly new files</p></li>
<li><p>Yearly new file space usage</p></li>
<li><p>Monthly new files</p></li>
<li><p>Monthly new file space usage</p></li>
</ul>
<p>From these we can see the following:</p>
<ul class="simple">
<li><p>Both the number of files and the space usage are growing non-linearly as the
number of new files and number of new bytes used are growing linearly.</p></li>
<li><p>July seems to be the month when a lot of new files are created, but it
is not the month when the largest files are created. Something strange is
definitely happening there.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-6-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-6-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-6-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_sum</span> <span class="o">=</span> <span class="n">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceUsage&#39;</span><span class="p">],</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">monthly_sum</span> <span class="o">=</span> <span class="n">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceUsage&#39;</span><span class="p">],</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>

<span class="n">yearly_sum</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yearly_sum</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">yearly_sum</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monthly_sum</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">))</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">yearly_sum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">yearly_sum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">monthly_sum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">monthly_sum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

   <span class="n">Year</span>     <span class="n">Files</span>      <span class="n">SpaceUsage</span>
<span class="mi">0</span>  <span class="mi">2010</span>   <span class="mi">5590287</span>   <span class="mi">2260716407068</span>
<span class="mi">1</span>  <span class="mi">2011</span>  <span class="mi">13197038</span>   <span class="mi">7000732111463</span>
<span class="mi">2</span>  <span class="mi">2012</span>  <span class="mi">17099900</span>  <span class="mi">15475575370580</span>
<span class="mi">3</span>  <span class="mi">2013</span>  <span class="mi">14755151</span>  <span class="mi">15445375302767</span>
<span class="mi">4</span>  <span class="mi">2014</span>  <span class="mi">26329321</span>  <span class="mi">42530364324322</span>
      <span class="n">Month</span>     <span class="n">Files</span>      <span class="n">SpaceUsage</span>
<span class="mi">0</span>   <span class="n">January</span>  <span class="mi">34921070</span>  <span class="mi">43131219269056</span>
<span class="mi">1</span>  <span class="n">February</span>  <span class="mi">35707864</span>  <span class="mi">71022501061692</span>
<span class="mi">2</span>     <span class="n">March</span>  <span class="mi">25494722</span>  <span class="mi">56516865081262</span>
<span class="mi">3</span>     <span class="n">April</span>  <span class="mi">31224476</span>  <span class="mi">75382094990077</span>
<span class="mi">4</span>       <span class="n">May</span>  <span class="mi">37816173</span>  <span class="mi">75338621861676</span>
</pre></div>
</div>
<img alt="../_images/newall_python.svg" src="../_images/newall_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-6-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_sum</span> <span class="o">&lt;-</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="s">&#39;SpaceUsage&#39;</span><span class="p">),</span> <span class="n">sum</span><span class="p">)</span>
<span class="n">monthly_sum</span> <span class="o">&lt;-</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Month&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="s">&#39;SpaceUsage&#39;</span><span class="p">),</span> <span class="n">sum</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">yearly_sum</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">monthly_sum</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">yearly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">yearly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsage</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">monthly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Month</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">monthly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsage</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Month</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">())</span>

<span class="n">Year</span>    <span class="n">Files</span>   <span class="n">SpaceUsage</span>
<span class="m">2010</span>    <span class="m">5590287</span>         <span class="m">2</span><span class="p">,</span><span class="m">260716e+12</span>
<span class="m">2011</span>    <span class="m">13197038</span>        <span class="m">7</span><span class="p">,</span><span class="m">000732e+12</span>
<span class="m">2012</span>    <span class="m">17099900</span>        <span class="m">1</span><span class="p">,</span><span class="m">547558e+13</span>
<span class="m">2013</span>    <span class="m">14755151</span>        <span class="m">1</span><span class="p">,</span><span class="m">544538e+13</span>
<span class="m">2014</span>    <span class="m">26329321</span>        <span class="m">4</span><span class="p">,</span><span class="m">253036e+13</span>
<span class="m">2015</span>    <span class="m">24896331</span>        <span class="m">3</span><span class="p">,</span><span class="m">096538e+13</span>
<span class="n">Month</span>   <span class="n">Files</span>   <span class="n">SpaceUsage</span>
<span class="n">Jan</span>     <span class="m">34921070</span>        <span class="m">4</span><span class="p">,</span><span class="m">313122e+13</span>
<span class="n">Feb</span>     <span class="m">35707864</span>        <span class="m">7</span><span class="p">,</span><span class="m">102250e+13</span>
<span class="n">Mar</span>     <span class="m">25494722</span>        <span class="m">5</span><span class="p">,</span><span class="m">651687e+13</span>
<span class="n">Apr</span>     <span class="m">31224476</span>        <span class="m">7</span><span class="p">,</span><span class="m">538209e+13</span>
<span class="n">May</span>     <span class="m">37816173</span>        <span class="m">7</span><span class="p">,</span><span class="m">533862e+13</span>
<span class="n">Jun</span>     <span class="m">33804495</span>        <span class="m">7</span><span class="p">,</span><span class="m">010947e+13</span>
</pre></div>
</div>
<img alt="../_images/newall1_r.svg" src="../_images/newall1_r.svg" /><img alt="../_images/newall2_r.svg" src="../_images/newall2_r.svg" /><img alt="../_images/newall3_r.svg" src="../_images/newall3_r.svg" /><img alt="../_images/newall4_r.svg" src="../_images/newall4_r.svg" /></div>
</div>
</div>
</div>
<div class="section" id="curve-fitting-fitting-functions-into-data">
<h2>Curve fitting - Fitting functions into data<a class="headerlink" href="#curve-fitting-fitting-functions-into-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="determining-the-growth-rate-of-file-space-usage">
<h3>Determining the growth rate of file space usage<a class="headerlink" href="#determining-the-growth-rate-of-file-space-usage" title="Permalink to this headline">¶</a></h3>
<p>A classic data analysis task is fitting a function to data. This is very common
in situations where the relationship between two variables can be derived from
a mathematical model (e.g physic) or when the data seems to come from a
distribution with an easily writable distribution function or cumulative
distribution function (e.g. gaussian).</p>
<p>Let’s consider the cumulative space usage of the file system. We can calculate
these values from our previously calculated summaries:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-7-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-7-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-7-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_cumsum</span> <span class="o">=</span> <span class="n">yearly_sum</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">yearly_cumsum</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">yearly_cumsum</span><span class="p">[[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="n">yearly_cumsum</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">Year</span>    <span class="n">Files</span>   <span class="n">SpaceUsage</span>
<span class="mi">0</span>       <span class="mi">2010</span>    <span class="mi">5590287</span>         <span class="mi">2260716407068</span>
<span class="mi">1</span>       <span class="mi">2011</span>    <span class="mi">18787325</span>        <span class="mi">9261448518531</span>
<span class="mi">2</span>       <span class="mi">2012</span>    <span class="mi">35887225</span>        <span class="mi">24737023889111</span>
<span class="mi">3</span>       <span class="mi">2013</span>    <span class="mi">50642376</span>        <span class="mi">40182399191878</span>
<span class="mi">4</span>       <span class="mi">2014</span>    <span class="mi">76971697</span>        <span class="mi">82712763516200</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-7-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_cumsum</span> <span class="o">&lt;-</span> <span class="n">yearly_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span>
        <span class="n">Files</span><span class="o">=</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">Files</span><span class="p">),</span>
        <span class="n">SpaceUsage</span><span class="o">=</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">SpaceUsage</span><span class="p">)</span>
    <span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">yearly_cumsum</span><span class="p">)</span>

<span class="n">Year</span>    <span class="n">Files</span>   <span class="n">SpaceUsage</span>
<span class="m">2010</span>    <span class="m">5590287</span>         <span class="m">2</span><span class="p">,</span><span class="m">260716e+12</span>
<span class="m">2011</span>    <span class="m">18787325</span>        <span class="m">9</span><span class="p">,</span><span class="m">261449e+12</span>
<span class="m">2012</span>    <span class="m">35887225</span>        <span class="m">2</span><span class="p">,</span><span class="m">473702e+13</span>
<span class="m">2013</span>    <span class="m">50642376</span>        <span class="m">4</span><span class="p">,</span><span class="m">018240e+13</span>
<span class="m">2014</span>    <span class="m">76971697</span>        <span class="m">8</span><span class="p">,</span><span class="m">271276e+13</span>
<span class="m">2015</span>    <span class="m">101868028</span>       <span class="m">1</span><span class="p">,</span><span class="m">136781e+14</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the space usage as a a bar chart.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-8-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-8-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-8-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">yearly_cumsum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/cumulative-space-usage_python.svg" src="../_images/cumulative-space-usage_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-8-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="n">yearly_cumsum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsage</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/cumulative-space-usage_r.svg" src="../_images/cumulative-space-usage_r.svg" /></div>
</div>
<p>Based on this graph the growth looks exponential. If this is the case, taking
a logarithm of our data should result in a linear plot. Let’s do just that:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-9-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-9-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-9-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_cumsum</span><span class="p">[</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yearly_cumsum</span><span class="p">[</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">yearly_cumsum</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/cumulative-logspace-usage_python.svg" src="../_images/cumulative-logspace-usage_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-9-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="n">yearly_cumsum</span> <span class="o">&lt;-</span> <span class="n">yearly_cumsum</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">SpaceUsageLog2</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">SpaceUsage</span><span class="p">))</span>

<span class="n">yearly_cumsum</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">Year</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">Year</span><span class="p">)))</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsageLog2</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/cumulative-logspace-usage_r.svg" src="../_images/cumulative-logspace-usage_r.svg" /></div>
</div>
<p>Here we have used logarithm with base 2 as that gives us a simple way of
interpreting our y-axis: each time the y-axis grows by one, our data doubles.
Looking at the plot it looks like the growth in last seven years (2014-2020)
has been steady. Let’s use those years for our fit.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-10-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-10-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-10-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit_dataset</span> <span class="o">=</span> <span class="n">yearly_cumsum</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">fit_dataset</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2013</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/cumulative-logspace-usage-fitrange_python.svg" src="../_images/cumulative-logspace-usage-fitrange_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-10-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">yearly_cumsum</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">Year</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">Year</span><span class="p">)))</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">Year</span> <span class="o">&gt;</span> <span class="m">2013</span><span class="p">)</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsageLog2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/cumulative-logspace-usage-fitrange_r.svg" src="../_images/cumulative-logspace-usage-fitrange_r.svg" /></div>
</div>
</div>
<div class="section" id="fitting-a-linear-model">
<h3>Fitting a linear model<a class="headerlink" href="#fitting-a-linear-model" title="Permalink to this headline">¶</a></h3>
<p>Linear models (or linear regressions) are commonly used in statistics to
explain relationships between different numerical variables. In our case,
as the data was linear, we can also use them as fitting models into our
data.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-11-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-11-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-11-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="c1"># Set up a linear model</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1"># Fit to the linear model. Notice that first argument needs to be 2D.</span>
<span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">]],</span><span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">])</span>
<span class="c1"># Print model coefs</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">model1</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>

<span class="p">[</span><span class="mf">0.52740083</span><span class="p">]</span> <span class="o">-</span><span class="mf">1015.9746062919537</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-11-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">modelr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="c1"># Set up a linear model</span>
<span class="n">lm_formula</span> <span class="o">&lt;-</span> <span class="nf">formula</span><span class="p">(</span><span class="n">SpaceUsageLog2</span> <span class="o">~</span> <span class="n">Year</span><span class="p">)</span>

<span class="c1"># Fit to the linear model. Notice that first argument needs to be 2D.</span>
<span class="n">model1</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">lm_formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">)</span>

<span class="c1"># Print model coefs</span>
<span class="nf">print</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>

<span class="c1"># Get tidy version the coefficients</span>
<span class="n">coefs</span> <span class="o">&lt;-</span> <span class="n">model1</span> <span class="o">%&gt;%</span>
    <span class="nf">tidy</span><span class="p">()</span> <span class="o">%&gt;%</span>
    <span class="nf">print</span><span class="p">()</span>


<span class="n">Call</span><span class="o">:</span>
<span class="nf">lm</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">lm_formula</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="p">)</span>

<span class="n">Coefficients</span><span class="o">:</span>
<span class="p">(</span><span class="n">Intercept</span><span class="p">)</span>         <span class="n">Year</span>
 <span class="m">-1015</span><span class="p">,</span><span class="m">9746</span>       <span class="m">0</span><span class="p">,</span><span class="m">5274</span>

<span class="c1"># A tibble: 2 x 5</span>
  <span class="n">term</span>         <span class="n">estimate</span> <span class="n">std.error</span> <span class="n">statistic</span>     <span class="n">p.value</span>
  <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>       <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">1</span> <span class="p">(</span><span class="n">Intercept</span><span class="p">)</span> <span class="m">-1016</span><span class="n">.</span>      <span class="m">34.5</span>        <span class="m">-29.5</span> <span class="m">0.000000843</span>
<span class="m">2</span> <span class="n">Year</span>            <span class="m">0.527</span>    <span class="m">0.0171</span>      <span class="m">30.9</span> <span class="m">0.000000671</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create predictions based on our model and plot the data with our
predictions.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-12-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-12-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-12-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict based on our model</span>
<span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">]])</span>

<span class="c1"># Plot the data and our model</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit with slope: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">model1</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/fit-logspace-model1_python.svg" src="../_images/fit-logspace-model1_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-12-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="c1"># Predict based on our model</span>
<span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">add_predictions</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">)</span>

<span class="n">slope</span> <span class="o">&lt;-</span> <span class="n">coefs</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">term</span> <span class="o">==</span> <span class="s">&#39;Year&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">as.numeric</span><span class="p">()</span>

<span class="n">slope_legend</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&#39;Fit with slope: %.3f&#39;</span><span class="p">,</span><span class="n">slope</span><span class="p">)</span>

<span class="c1"># Plot the data and our model</span>
<span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsageLog2</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;Data&#39;</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">SpaceUsagePredictedLog2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">slope_legend</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">scale_color_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/fit-logspace-model1_r.svg" src="../_images/fit-logspace-model1_r.svg" /></div>
</div>
<p>We could have also used a simple least squares curve fitting with a function we
have defined ourselves.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-13-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-13-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-13-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># Set up a linear model</span>
<span class="k">def</span> <span class="nf">model2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span>

<span class="c1"># Fit to the linear model</span>
<span class="n">coefs</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">])</span>

<span class="c1"># Print model coefs</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>

<span class="c1"># Predict based on our model</span>
<span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model2</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="o">*</span><span class="n">coefs</span><span class="p">)</span>

<span class="c1"># Plot the data and our model</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsageLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit with slope: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="p">[</span> <span class="mf">5.27400831e-01</span> <span class="o">-</span><span class="mf">1.01597461e+03</span><span class="p">]</span>
</pre></div>
</div>
<img alt="../_images/fit-logspace-model2_python.svg" src="../_images/fit-logspace-model2_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-13-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a linear model</span>
<span class="n">formula2</span> <span class="o">&lt;-</span> <span class="n">SpaceUsageLog2</span> <span class="o">~</span> <span class="n">a</span> <span class="o">*</span> <span class="n">Year</span> <span class="o">+</span> <span class="n">b</span>

<span class="c1"># Fit to the linear model</span>
<span class="n">model2</span> <span class="o">&lt;-</span> <span class="nf">nls</span><span class="p">(</span><span class="n">formula2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">)</span>

<span class="c1"># Predict based on our model</span>
<span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">add_predictions</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">)</span>

<span class="c1"># Get tidy version the coefficients</span>
<span class="n">coefs</span> <span class="o">&lt;-</span> <span class="n">model2</span> <span class="o">%&gt;%</span>
    <span class="nf">tidy</span><span class="p">()</span> <span class="o">%&gt;%</span>
    <span class="nf">print</span><span class="p">()</span>

<span class="c1"># Predict based on our model</span>
<span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">add_predictions</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;SpaceUsagePredictedLog2&#39;</span><span class="p">)</span>

<span class="c1"># Format legend text</span>
<span class="n">slope</span> <span class="o">&lt;-</span> <span class="n">coefs</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">term</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">as.numeric</span><span class="p">()</span>
<span class="n">slope_legend</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&#39;Fit with slope: %.3f&#39;</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>

<span class="c1"># Plot the data and our model</span>
<span class="n">fit_dataset</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsageLog2</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;Data&#39;</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">SpaceUsagePredictedLog2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">slope_legend</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">scale_color_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

 <span class="n">Warning</span> <span class="n">message</span> <span class="n">in</span> <span class="nf">nls</span><span class="p">(</span><span class="n">formula2</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="p">)</span><span class="o">:</span>
“<span class="n">No</span> <span class="n">starting</span> <span class="n">values</span> <span class="n">specified</span> <span class="n">for</span> <span class="n">some</span> <span class="n">parameters.</span>
<span class="n">Initializing</span> ‘<span class="n">a</span>’<span class="p">,</span> ‘<span class="n">b</span>’ <span class="n">to</span> <span class="s">&#39;1.&#39;</span><span class="n">.</span>
<span class="n">Consider</span> <span class="n">specifying</span> <span class="s">&#39;start&#39;</span> <span class="n">or</span> <span class="n">using</span> <span class="n">a</span> <span class="n">selfStart</span> <span class="n">model</span>”

<span class="c1"># A tibble: 2 x 5</span>
  <span class="n">term</span>   <span class="n">estimate</span> <span class="n">std.error</span> <span class="n">statistic</span>     <span class="n">p.value</span>
  <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>       <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span>
<span class="m">1</span> <span class="n">a</span>         <span class="m">0.527</span>    <span class="m">0.0171</span>      <span class="m">30.9</span> <span class="m">0.000000671</span>
<span class="m">2</span> <span class="n">b</span>     <span class="m">-1016</span><span class="n">.</span>      <span class="m">34.5</span>        <span class="m">-29.5</span> <span class="m">0.000000843</span>
</pre></div>
</div>
<img alt="../_images/fit-logspace-model2_r.svg" src="../_images/fit-logspace-model2_r.svg" /></div>
</div>
<p>Both of these models produced identical coefficients. Let’s create a function
that can do the fitting for us.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-14-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-14-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-14-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit_dataset</span> <span class="o">=</span> <span class="n">yearly_cumsum</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit_exponential</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">y_column</span><span class="p">,</span> <span class="n">fit_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">fit_dataset</span> <span class="o">=</span> <span class="n">dataset</span>

    <span class="c1"># If fit_range is defined, limit fit to that range</span>
    <span class="k">if</span> <span class="n">fit_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fit_dataset</span> <span class="o">=</span> <span class="n">fit_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fit_range</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># Set up a linear model</span>
    <span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span>

    <span class="n">y_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">[</span><span class="n">y_column</span><span class="p">])</span>

    <span class="c1"># Fit to the linear model</span>
    <span class="n">coefs</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">y_log</span><span class="p">)</span>

    <span class="c1"># Predict based on our model</span>
    <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;Predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="o">*</span><span class="n">coefs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">coefs</span>

<span class="n">fit_dataset_final</span><span class="p">,</span> <span class="n">coefs</span> <span class="o">=</span> <span class="n">fit_exponential</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2013</span><span class="p">)</span>

<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset_final</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset_final</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit with exponent: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/fit-space-function_python.svg" src="../_images/fit-space-function_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-14-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">fit_exponential</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">y_column</span><span class="p">,</span> <span class="n">fit_range</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">dataset</span>

    <span class="c1"># If fit_range is defined, limit fit to that range</span>
    <span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">fit_range</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">fit_dataset</span><span class="p">[</span><span class="n">fit_range</span><span class="p">,]</span>
    <span class="p">}</span>
    <span class="c1"># Set up a linear model</span>
    <span class="n">linear_formula</span> <span class="o">&lt;-</span> <span class="nf">as.formula</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">y_column</span><span class="p">,</span> <span class="s">&#39; ~ a * &#39;</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span><span class="s">&#39; + b&#39;</span><span class="p">))</span>

    <span class="n">fit_dataset</span><span class="p">[</span><span class="n">y_column</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">log2</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">[</span><span class="n">y_column</span><span class="p">])</span>

    <span class="c1"># Fit to the linear model</span>
    <span class="n">linear_model</span> <span class="o">&lt;-</span> <span class="nf">nls</span><span class="p">(</span><span class="n">linear_formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">)</span>

    <span class="c1"># Get tidy version the coefficients</span>
    <span class="n">coefs</span> <span class="o">&lt;-</span> <span class="n">linear_model</span> <span class="o">%&gt;%</span>
        <span class="nf">tidy</span><span class="p">()</span>

    <span class="c1"># Predict based on our model</span>
    <span class="n">return_dataset</span> <span class="o">&lt;-</span> <span class="n">dataset</span> <span class="o">%&gt;%</span>
        <span class="nf">add_predictions</span><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;Predicted&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate</span><span class="p">(</span><span class="n">Predicted</span><span class="o">=</span><span class="m">2</span> <span class="o">^</span> <span class="n">Predicted</span><span class="p">)</span>

    <span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">return_dataset</span><span class="p">,</span> <span class="n">coefs</span><span class="o">=</span><span class="n">coefs</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">fit_dataset</span> <span class="o">&lt;-</span> <span class="n">yearly_cumsum</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">Year</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">Year</span><span class="p">)))</span>

<span class="c1"># Fit exponential using our function</span>
<span class="n">output</span> <span class="o">&lt;-</span> <span class="nf">fit_exponential</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="s">&#39;Year&#39;</span><span class="p">,</span> <span class="s">&#39;SpaceUsage&#39;</span><span class="p">,</span> <span class="n">fit_range</span><span class="o">=</span><span class="n">fit_dataset</span><span class="p">[</span><span class="s">&#39;Year&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="m">2013</span><span class="p">)</span>
<span class="n">fit_dataset_final</span> <span class="o">&lt;-</span> <span class="n">output</span><span class="o">$</span><span class="n">data</span>
<span class="n">coefs</span> <span class="o">&lt;-</span> <span class="n">output</span><span class="o">$</span><span class="n">coefs</span>

<span class="c1"># Format legend text</span>
<span class="n">slope</span> <span class="o">&lt;-</span> <span class="n">coefs</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">term</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">as.numeric</span><span class="p">()</span>
<span class="n">slope_legend</span> <span class="o">&lt;-</span> <span class="nf">sprintf</span><span class="p">(</span><span class="s">&#39;Fit with exponent: %.3f&#39;</span><span class="p">,</span><span class="n">slope</span><span class="p">)</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="c1"># Plot the data and our model</span>
<span class="n">fit_dataset_final</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">SpaceUsage</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;Data&#39;</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Predicted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">slope_legend</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">scale_color_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/fit-space-function_r.svg" src="../_images/fit-space-function_r.svg" /></div>
</div>
</div>
</div>
<div class="section" id="using-bootstrapping-resampling-methods-for-the-calculation-of-statistical-moments">
<span id="chapter-3-bootstrap"></span><h2>Using bootstrapping/resampling methods for the calculation of statistical moments<a class="headerlink" href="#using-bootstrapping-resampling-methods-for-the-calculation-of-statistical-moments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="quick-overview-of-bootstrapping">
<h3>Quick overview of bootstrapping<a class="headerlink" href="#quick-overview-of-bootstrapping" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">Bootstrapping methods</a>
are commonly used to calculate statistical moments (mean, variance, etc.) from
a sample distribution obtained from raw data.</p>
<p>The basic idea of bootstrapping methods is that if you have a sample
distribution and you want to calculate e.g. distribution for the sample mean,
you can take lots of resamples from the distribution with replacement and
calculate means for those resamples. Now the distribution of these means
will approach the distribution of the sample mean due to the
<a class="reference external" href="https://en.wikipedia.org/wiki/Law_of_large_numbers">law of large numbers</a>.</p>
<p>Let’s use these methods to calculate the mean file size. First, we need to get
a grouping based on both <code class="docutils literal notranslate"><span class="pre">Year</span></code> and <code class="docutils literal notranslate"><span class="pre">BytesLog2</span></code>.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-15-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-15-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-15-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop rows with NaNs (invalid years)</span>
<span class="n">newfiles_relevant2</span> <span class="o">=</span> <span class="n">filesizes</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Pick relevant columns</span>
<span class="n">newfiles_relevant2</span> <span class="o">=</span> <span class="n">newfiles_relevant2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span><span class="s1">&#39;Files&#39;</span><span class="p">]]</span>
<span class="c1"># Aggregate based on Year and BytesLog2</span>
<span class="n">newfiles_yearly_sum2</span> <span class="o">=</span> <span class="n">newfiles_relevant2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

<span class="n">newfiles_yearly_sum2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

                <span class="n">Files</span>
<span class="n">Year</span>    <span class="n">BytesLog2</span>
<span class="mf">2010.0</span>  <span class="mi">0</span>       <span class="mi">124</span>
        <span class="mi">1</span>       <span class="mi">1632</span>
        <span class="mi">2</span>       <span class="mi">5626</span>
        <span class="mi">3</span>       <span class="mi">26287</span>
        <span class="mi">4</span>       <span class="mi">65074</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-15-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">newfiles_relevant2</span> <span class="o">&lt;-</span> <span class="n">filesizes</span> <span class="o">%&gt;%</span>
    <span class="c1"># Drop rows with NaNs (invalid years)</span>
    <span class="nf">drop_na</span><span class="p">()</span> <span class="o">%&gt;%</span>
    <span class="c1"># Pick relevant columns</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">BytesLog2</span><span class="p">,</span> <span class="n">Files</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="c1"># Aggregate based on Year and BytesLog2</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">BytesLog2</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">Files</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">Files</span><span class="p">))</span>

<span class="nf">head</span><span class="p">(</span><span class="n">newfiles_relevant2</span><span class="p">)</span>

<span class="n">Year</span>    <span class="n">BytesLog2</span>       <span class="n">Files</span>
<span class="m">2010</span>    <span class="m">0</span>       <span class="m">124</span>
<span class="m">2010</span>    <span class="m">1</span>       <span class="m">1632</span>
<span class="m">2010</span>    <span class="m">2</span>       <span class="m">5626</span>
<span class="m">2010</span>    <span class="m">3</span>       <span class="m">26287</span>
<span class="m">2010</span>    <span class="m">4</span>       <span class="m">65074</span>
<span class="m">2010</span>    <span class="m">5</span>       <span class="m">202543</span>
</pre></div>
</div>
</div>
</div>
<p>From here we can see that our data is grouped in two different layers: first
in terms of <code class="docutils literal notranslate"><span class="pre">Year</span></code> and then in terms of <code class="docutils literal notranslate"><span class="pre">BytesLog2</span></code>. Summation is
afterwards done for <code class="docutils literal notranslate"><span class="pre">Files</span></code>.</p>
<p>Now we can notice that because our function <code class="docutils literal notranslate"><span class="pre">aggregate_filesize_data</span></code> took
its arguments as lists, we can use it to do these aggregations as well. We can
use it to get our aggregated data and plot the size distribution of new files
for year 2020:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-16-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-16-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-16-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_bytes_sum</span> <span class="o">=</span> <span class="n">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceUsage&#39;</span><span class="p">],</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>

<span class="n">bytes_2020</span> <span class="o">=</span> <span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">bytes_2020</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="mi">2020</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/file-distribution-2020_python.svg" src="../_images/file-distribution-2020_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-16-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_bytes_sum</span> <span class="o">=</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">,</span><span class="s">&#39;BytesLog2&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="s">&#39;SpaceUsage&#39;</span><span class="p">),</span> <span class="n">sum</span><span class="p">)</span>

<span class="n">bytes_2020</span> <span class="o">&lt;-</span> <span class="n">yearly_bytes_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">Year</span> <span class="o">==</span> <span class="m">2020</span><span class="p">)</span>

<span class="n">bytes_2020</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">BytesLog2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">BytesLog2</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span>
    <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/file-distribution-2020_r.svg" src="../_images/file-distribution-2020_r.svg" /></div>
</div>
<p>Let’s use
<a class="reference external" href="https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.random.choice.html#numpy.random.choice">np.random.choice</a>
(Python) /
<a class="reference external" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/sample">sample</a>
(R) for the sampling because these functions are much faster when we’re creating
hundreds to thousands of samples (resampling functions of Pandas/Tidyverse are
designed for few random samples).</p>
<p>Now we’ll want to pick from all available byte sizes with replacement (each
byte size can be picked more than once) and we’ll want to weight the picking
probabilities with the distribution of our sample data (new files created on
2020).</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-17-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-17-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-17-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick target data column and convert it to integer</span>
<span class="n">target_data</span> <span class="o">=</span> <span class="n">bytes_2020</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="c1"># Pick weight data column</span>
<span class="n">weight_data</span> <span class="o">=</span> <span class="n">bytes_2020</span><span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># IMPORTANT:</span>
<span class="c1">#    There might be categories in BytesLog2 that do not contain any data.</span>
<span class="c1">#    We&#39;ll have to fill zeros to those rows of Files.</span>
<span class="n">weight_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Normalize weight_data into probabilities</span>
<span class="n">weight_data</span> <span class="o">=</span> <span class="n">weight_data</span><span class="o">/</span><span class="n">weight_data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">target_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">weight_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="mi">430</span>    <span class="mi">0</span>
<span class="mi">431</span>    <span class="mi">1</span>
<span class="mi">432</span>    <span class="mi">2</span>
<span class="mi">433</span>    <span class="mi">3</span>
<span class="mi">434</span>    <span class="mi">4</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">BytesLog2</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
<span class="mi">430</span>    <span class="mf">0.000327</span>
<span class="mi">431</span>    <span class="mf">0.001940</span>
<span class="mi">432</span>    <span class="mf">0.001471</span>
<span class="mi">433</span>    <span class="mf">0.007406</span>
<span class="mi">434</span>    <span class="mf">0.014570</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Files</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-17-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick target data column and convert it to integer</span>
<span class="c1"># IMPORTANT:</span>
<span class="c1">#    Do notice that we&#39;ll have to first convert our target</span>
<span class="c1">#    into characters as we do not want convert factor ENCODING,</span>
<span class="c1">#    but the actual decoded DATA</span>
<span class="n">target_data</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">bytes_2020</span><span class="p">[[</span><span class="s">&#39;BytesLog2&#39;</span><span class="p">]]))</span>

<span class="c1"># Pick weight data column</span>
<span class="n">weight_data</span> <span class="o">&lt;-</span> <span class="n">bytes_2020</span><span class="p">[[</span><span class="s">&#39;Files&#39;</span><span class="p">]]</span>

<span class="c1"># Normalize weight_data into probabilities</span>
<span class="n">weight_data</span> <span class="o">&lt;-</span> <span class="n">weight_data</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">weight_data</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">target_data</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">weight_data</span><span class="p">))</span>

<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0</span><span class="p">,</span><span class="m">0003271367</span> <span class="m">0</span><span class="p">,</span><span class="m">0019404559</span> <span class="m">0</span><span class="p">,</span><span class="m">0014705603</span> <span class="m">0</span><span class="p">,</span><span class="m">0074056601</span> <span class="m">0</span><span class="p">,</span><span class="m">0145700668</span>
<span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="m">0</span><span class="p">,</span><span class="m">0156263905</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can create a vector of means and fill it with random resampled means.
The sample mean of our original distribution is then the mean of this vector.
By looking at our plot we can see that the sample mean corresponds well with
the peak of the distribution.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-18-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-18-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-18-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create means vector</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Calculate resampled mean</span>
    <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">weight_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">means</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated sample mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>

<span class="p">[</span><span class="mf">13.06</span> <span class="mf">13.27</span> <span class="mf">13.57</span> <span class="mf">13.45</span> <span class="mf">12.7</span>  <span class="mf">13.05</span> <span class="mf">13.28</span> <span class="mf">12.94</span> <span class="mf">12.91</span> <span class="mf">14.07</span><span class="p">]</span>
<span class="n">Estimated</span> <span class="n">sample</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">13.229999999999999</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-18-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create means vector</span>
<span class="n">means</span> <span class="o">&lt;-</span> <span class="nf">numeric</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># Calculate resampled mean</span>
    <span class="n">means</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="n">weight_data</span><span class="p">))</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;Estimated sample mean: &#39;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">means</span><span class="p">)))</span>

<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">12</span><span class="p">,</span><span class="m">19</span> <span class="m">12</span><span class="p">,</span><span class="m">19</span> <span class="m">12</span><span class="p">,</span><span class="m">80</span> <span class="m">12</span><span class="p">,</span><span class="m">90</span> <span class="m">13</span><span class="p">,</span><span class="m">18</span> <span class="m">13</span><span class="p">,</span><span class="m">48</span> <span class="m">12</span><span class="p">,</span><span class="m">97</span> <span class="m">12</span><span class="p">,</span><span class="m">39</span> <span class="m">13</span><span class="p">,</span><span class="m">49</span> <span class="m">12</span><span class="p">,</span><span class="m">57</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;Estimated sample mean: 12,816&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now create a function for this bootstrapping feature:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-19-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-19-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-19-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_bootstrapped_means</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="c1"># Pick relevant columns</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="n">target_col</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># Pick target data column</span>
    <span class="n">target_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    <span class="c1"># Pick weight data column</span>
    <span class="n">weight_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">weight_col</span><span class="p">]</span>
    <span class="c1"># Fill zeros to those byte sizes that are not present in the Files-data</span>
    <span class="n">weight_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Normalize weight_data into probabilities</span>
    <span class="n">weight_data</span> <span class="o">=</span> <span class="n">weight_data</span><span class="o">/</span><span class="n">weight_data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Create means vector</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_means</span><span class="p">):</span>
        <span class="c1"># Calculate resampled mean</span>
        <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">weight_data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">means</span>

<span class="n">bootstrapped_means</span> <span class="o">=</span> <span class="n">get_bootstrapped_means</span><span class="p">(</span><span class="n">bytes_2020</span><span class="p">,</span> <span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated sample mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">))</span>

<span class="p">[</span><span class="mf">12.59</span> <span class="mf">13.9</span>  <span class="mf">13.09</span> <span class="mf">13.34</span> <span class="mf">12.65</span> <span class="mf">13.1</span>  <span class="mf">13.16</span> <span class="mf">12.98</span> <span class="mf">13.28</span> <span class="mf">12.74</span><span class="p">]</span>
<span class="n">Estimated</span> <span class="n">sample</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">13.225010000000001</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-19-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">get_bootstrapped_means</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Pick relevant columns</span>
    <span class="c1"># Pick target data column and convert it to integer</span>
    <span class="n">target_data</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">dataset</span><span class="p">[[</span><span class="n">target_col</span><span class="p">]]))</span>
    <span class="c1"># Pick weight data column</span>
    <span class="n">weight_data</span> <span class="o">&lt;-</span> <span class="n">dataset</span><span class="p">[[</span><span class="n">weight_col</span><span class="p">]]</span>
    <span class="n">weight_data</span> <span class="o">&lt;-</span> <span class="n">weight_data</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">weight_data</span><span class="p">)</span>

    <span class="c1"># Create means vector</span>
    <span class="n">means</span> <span class="o">&lt;-</span> <span class="nf">numeric</span><span class="p">(</span><span class="n">n_means</span><span class="p">)</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">n_means</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># Calculate resampled mean</span>
        <span class="n">means</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="n">weight_data</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">means</span> <span class="o">&lt;-</span> <span class="nf">get_bootstrapped_means</span><span class="p">(</span><span class="n">bytes_2020</span><span class="p">,</span> <span class="s">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;Estimated sample mean: &#39;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">means</span><span class="p">)))</span>

<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">13</span><span class="p">,</span><span class="m">47</span> <span class="m">13</span><span class="p">,</span><span class="m">78</span> <span class="m">13</span><span class="p">,</span><span class="m">11</span> <span class="m">12</span><span class="p">,</span><span class="m">75</span> <span class="m">13</span><span class="p">,</span><span class="m">50</span> <span class="m">12</span><span class="p">,</span><span class="m">83</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;Estimated sample mean: 13,2317&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-nested-dataframes-to-help-with-bootstrapping">
<h3>Using nested dataframes to help with bootstrapping<a class="headerlink" href="#using-nested-dataframes-to-help-with-bootstrapping" title="Permalink to this headline">¶</a></h3>
<p>Models that need multiple columns (or even the full dataset), but need to be
grouped along some column, are usually easier to run using nested dataframes.
When using nested dataframes we split our initial data based on a grouping and
apply some function for each of these dataframes. The result of this function
can be a dataframe.</p>
<p>This can be visualized in the following way:</p>
<img alt="../_images/dataframe-nested2.svg" src="../_images/dataframe-nested2.svg" /><p>Lets create a nested view of our data (<code class="docutils literal notranslate"><span class="pre">yearly_bytes_sum</span></code>):</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-20-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-20-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-20-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_means</span> <span class="o">=</span> <span class="n">yearly_bytes_sum</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}))</span>
<span class="n">bootstrapped_means</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">data</span>
<span class="n">Year</span>
<span class="mf">2010.0</span>  <span class="n">Year</span> <span class="n">BytesLog2</span> <span class="n">Files</span> <span class="n">SpaceUsage</span> <span class="o">...</span>
<span class="mf">2011.0</span>  <span class="n">Year</span> <span class="n">BytesLog2</span> <span class="n">Files</span> <span class="n">SpaceUsage</span> <span class="o">...</span>
<span class="mf">2012.0</span>  <span class="n">Year</span> <span class="n">BytesLog2</span> <span class="n">Files</span> <span class="n">SpaceUsage</span><span class="o">...</span>
<span class="mf">2013.0</span>  <span class="n">Year</span> <span class="n">BytesLog2</span> <span class="n">Files</span> <span class="n">SpaceUsage</span><span class="o">...</span>
<span class="mf">2014.0</span>  <span class="n">Year</span> <span class="n">BytesLog2</span> <span class="n">Files</span> <span class="n">SpaceUsage</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-20-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">yearly_bytes_sum_nested</span> <span class="o">&lt;-</span> <span class="n">yearly_bytes_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">nest</span><span class="p">()</span>

<span class="nf">glimpse</span><span class="p">(</span><span class="n">yearly_bytes_sum_nested</span><span class="p">)</span>

<span class="n">Observations</span><span class="o">:</span> <span class="m">11</span>
<span class="n">Variables</span><span class="o">:</span> <span class="m">2</span>
<span class="o">$</span> <span class="n">Year</span> <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="m">2010</span><span class="p">,</span> <span class="m">2011</span><span class="p">,</span> <span class="m">2012</span><span class="p">,</span> <span class="m">2013</span><span class="p">,</span> <span class="m">2014</span><span class="p">,</span> <span class="m">2015</span><span class="p">,</span> <span class="m">2016</span><span class="p">,</span> <span class="m">2017</span><span class="p">,</span> <span class="m">2018</span><span class="p">,</span> <span class="m">2019</span><span class="p">,</span> <span class="m">2020</span>
<span class="o">$</span> <span class="n">data</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">37</span> <span class="n">x</span> <span class="m">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">37</span> <span class="n">x</span> <span class="m">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">38</span> <span class="n">x</span> <span class="m">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span>…
</pre></div>
</div>
</div>
</div>
<p>Now we can create bootstrapped means for all of the years with
apply/map-statements.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-21-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-21-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-21-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_bootstrapped_means</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="n">bootstrapped_means</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bootstrapped_means</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">SampledMeans</span>
<span class="n">Year</span>
<span class="mf">2010.0</span>  <span class="p">[</span><span class="mf">13.07</span><span class="p">,</span> <span class="mf">13.32</span><span class="p">,</span> <span class="mf">13.34</span><span class="p">,</span> <span class="mf">12.34</span><span class="p">,</span> <span class="mf">13.03</span><span class="p">]</span>
<span class="mf">2011.0</span>  <span class="p">[</span><span class="mf">13.73</span><span class="p">,</span> <span class="mf">14.56</span><span class="p">,</span> <span class="mf">14.2</span><span class="p">,</span> <span class="mf">13.89</span><span class="p">,</span> <span class="mf">13.71</span><span class="p">]</span>
<span class="mf">2012.0</span>  <span class="p">[</span><span class="mf">9.9</span><span class="p">,</span> <span class="mf">9.73</span><span class="p">,</span> <span class="mf">10.42</span><span class="p">,</span> <span class="mf">10.63</span><span class="p">,</span> <span class="mf">10.59</span><span class="p">]</span>
<span class="mf">2013.0</span>  <span class="p">[</span><span class="mf">13.52</span><span class="p">,</span> <span class="mf">13.35</span><span class="p">,</span> <span class="mf">13.14</span><span class="p">,</span> <span class="mf">13.22</span><span class="p">,</span> <span class="mf">14.02</span><span class="p">]</span>
<span class="mf">2014.0</span>  <span class="p">[</span><span class="mf">14.01</span><span class="p">,</span> <span class="mf">14.49</span><span class="p">,</span> <span class="mf">13.68</span><span class="p">,</span> <span class="mf">14.05</span><span class="p">,</span> <span class="mf">13.72</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-21-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_means</span> <span class="o">&lt;-</span> <span class="n">yearly_bytes_sum_nested</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">SampledMeans</span><span class="o">=</span><span class="nf">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">get_bootstrapped_means</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">5</span><span class="p">)))</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">data</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">glimpse</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>

<span class="n">Observations</span><span class="o">:</span> <span class="m">11</span>
<span class="n">Variables</span><span class="o">:</span> <span class="m">2</span>
<span class="o">$</span> <span class="n">Year</span>         <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="m">2010</span><span class="p">,</span> <span class="m">2011</span><span class="p">,</span> <span class="m">2012</span><span class="p">,</span> <span class="m">2013</span><span class="p">,</span> <span class="m">2014</span><span class="p">,</span> <span class="m">2015</span><span class="p">,</span> <span class="m">2016</span><span class="p">,</span> <span class="m">2017</span><span class="p">,</span> <span class="m">2018</span><span class="p">,</span> <span class="m">20</span>…
<span class="o">$</span> <span class="n">SampledMeans</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="m">12</span><span class="p">,</span><span class="m">94</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span><span class="m">74</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">03</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">21</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="m">14</span><span class="p">,</span><span class="m">33</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span><span class="m">01</span><span class="p">,</span> <span class="m">14</span>…
<span class="c1"># A tibble: 11 x 2</span>
   <span class="n">Year</span>  <span class="n">SampledMeans</span>
   <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span>
 <span class="m">1</span> <span class="m">2010</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">2</span> <span class="m">2011</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">3</span> <span class="m">2012</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">4</span> <span class="m">2013</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">5</span> <span class="m">2014</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">6</span> <span class="m">2015</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">7</span> <span class="m">2016</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">8</span> <span class="m">2017</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
 <span class="m">9</span> <span class="m">2018</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
<span class="m">10</span> <span class="m">2019</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>
<span class="m">11</span> <span class="m">2020</span>  <span class="o">&lt;</span><span class="n">dbl</span> <span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="o">&gt;</span>

<span class="n">Year</span>    <span class="n">SampledMeans</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">94</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span><span class="m">74</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">03</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">21</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can calculate means for each of these bootstrapped means:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-22-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-22-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-22-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="n">bootstrapped_means</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">SampledMeans</span>    <span class="n">Mean</span>
<span class="n">Year</span>
<span class="mf">2010.0</span>  <span class="p">[</span><span class="mf">13.07</span><span class="p">,</span> <span class="mf">13.32</span><span class="p">,</span> <span class="mf">13.34</span><span class="p">,</span> <span class="mf">12.34</span><span class="p">,</span> <span class="mf">13.03</span><span class="p">]</span>     <span class="mf">13.020</span>
<span class="mf">2011.0</span>  <span class="p">[</span><span class="mf">13.73</span><span class="p">,</span> <span class="mf">14.56</span><span class="p">,</span> <span class="mf">14.2</span><span class="p">,</span> <span class="mf">13.89</span><span class="p">,</span> <span class="mf">13.71</span><span class="p">]</span>      <span class="mf">14.018</span>
<span class="mf">2012.0</span>  <span class="p">[</span><span class="mf">9.9</span><span class="p">,</span> <span class="mf">9.73</span><span class="p">,</span> <span class="mf">10.42</span><span class="p">,</span> <span class="mf">10.63</span><span class="p">,</span> <span class="mf">10.59</span><span class="p">]</span>        <span class="mf">10.254</span>
<span class="mf">2013.0</span>  <span class="p">[</span><span class="mf">13.52</span><span class="p">,</span> <span class="mf">13.35</span><span class="p">,</span> <span class="mf">13.14</span><span class="p">,</span> <span class="mf">13.22</span><span class="p">,</span> <span class="mf">14.02</span><span class="p">]</span>     <span class="mf">13.450</span>
<span class="mf">2014.0</span>  <span class="p">[</span><span class="mf">14.01</span><span class="p">,</span> <span class="mf">14.49</span><span class="p">,</span> <span class="mf">13.68</span><span class="p">,</span> <span class="mf">14.05</span><span class="p">,</span> <span class="mf">13.72</span><span class="p">]</span>     <span class="mf">13.990</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-22-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_means</span> <span class="o">&lt;-</span> <span class="n">bootstrapped_means</span>  <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">Mean</span><span class="o">=</span><span class="nf">map</span><span class="p">(</span><span class="n">SampledMeans</span><span class="p">,</span> <span class="n">mean</span><span class="p">))</span>

<span class="nf">head</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>

<span class="n">Year</span>    <span class="n">SampledMeans</span>    <span class="n">Mean</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">94</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span><span class="m">74</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">03</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">21</span>       <span class="m">13</span><span class="p">,</span><span class="m">008</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create a function for this procedure so that we can run it for multiple
different columns:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-23-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-23-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-23-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_byteslog2_mean</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">group_variable</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>

    <span class="n">bootstrapping_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_bootstrapped_means</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="n">n_means</span><span class="p">)</span>

    <span class="n">bootstrapped_means</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">target_variable</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}))</span>
    <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">bootstrapping_function</span><span class="p">)</span>
    <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bootstrapped_means</span><span class="p">[</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
    <span class="n">bootstrapped_means</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bootstrapped_means</span>

<span class="n">bootstrapped_yearly_means</span> <span class="o">=</span> <span class="n">bootstrap_byteslog2_mean</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">bootstrapped_yearly_means</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

            <span class="n">SampledMeans</span>        <span class="n">Mean</span>
<span class="n">Year</span>
<span class="mf">2010.0</span>  <span class="p">[</span><span class="mf">12.55</span><span class="p">,</span> <span class="mf">12.83</span><span class="p">,</span> <span class="mf">14.01</span><span class="p">,</span> <span class="mf">12.28</span><span class="p">,</span> <span class="mf">12.86</span><span class="p">,</span> <span class="mf">13.04</span><span class="p">,</span> <span class="mf">13.</span><span class="o">...</span>       <span class="mf">12.97764</span>
<span class="mf">2011.0</span>  <span class="p">[</span><span class="mf">14.27</span><span class="p">,</span> <span class="mf">14.27</span><span class="p">,</span> <span class="mf">13.89</span><span class="p">,</span> <span class="mf">13.97</span><span class="p">,</span> <span class="mf">13.81</span><span class="p">,</span> <span class="mf">13.76</span><span class="p">,</span> <span class="mf">13.</span><span class="o">...</span>       <span class="mf">14.05083</span>
<span class="mf">2012.0</span>  <span class="p">[</span><span class="mf">10.69</span><span class="p">,</span> <span class="mf">10.88</span><span class="p">,</span> <span class="mf">11.12</span><span class="p">,</span> <span class="mf">10.09</span><span class="p">,</span> <span class="mf">11.15</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span> <span class="mf">10.</span><span class="o">...</span>       <span class="mf">10.65042</span>
<span class="mf">2013.0</span>  <span class="p">[</span><span class="mf">13.39</span><span class="p">,</span> <span class="mf">13.01</span><span class="p">,</span> <span class="mf">13.22</span><span class="p">,</span> <span class="mf">13.61</span><span class="p">,</span> <span class="mf">12.81</span><span class="p">,</span> <span class="mf">12.82</span><span class="p">,</span> <span class="mf">13.</span><span class="o">...</span>       <span class="mf">13.39958</span>
<span class="mf">2014.0</span>  <span class="p">[</span><span class="mf">14.04</span><span class="p">,</span> <span class="mf">13.96</span><span class="p">,</span> <span class="mf">14.5</span><span class="p">,</span> <span class="mf">13.21</span><span class="p">,</span> <span class="mf">13.64</span><span class="p">,</span> <span class="mf">14.68</span><span class="p">,</span> <span class="mf">14.3</span><span class="o">...</span>       <span class="mf">14.03843</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-23-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrap_byteslog2_mean</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">group_variable</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">bootstrapping_function</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">get_bootstrapped_means</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="n">n_means</span><span class="p">)</span>

    <span class="n">bootstrapped_means</span> <span class="o">&lt;-</span> <span class="n">dataset</span> <span class="o">%&gt;%</span>
        <span class="nf">group_by_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">group_variable</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="nf">nest</span><span class="p">()</span> <span class="o">%&gt;%</span>
        <span class="nf">mutate</span><span class="p">(</span>
            <span class="n">SampledMeans</span><span class="o">=</span><span class="nf">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bootstrapping_function</span><span class="p">),</span>
            <span class="n">Mean</span><span class="o">=</span><span class="nf">map</span><span class="p">(</span><span class="n">SampledMeans</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&#39;SampledMeans&#39;</span><span class="p">]])))</span> <span class="o">%&gt;%</span>
        <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">data</span><span class="p">)</span>

    <span class="nf">return</span><span class="p">(</span><span class="n">bootstrapped_means</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">bootstrapped_yearly_means</span> <span class="o">=</span> <span class="nf">bootstrap_byteslog2_mean</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">,</span> <span class="s">&#39;Year&#39;</span><span class="p">,</span> <span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">glimpse</span><span class="p">(</span><span class="n">bootstrapped_yearly_means</span><span class="p">)</span>

<span class="n">Observations</span><span class="o">:</span> <span class="m">11</span>
<span class="n">Variables</span><span class="o">:</span> <span class="m">3</span>
<span class="o">$</span> <span class="n">Year</span>         <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="m">2010</span><span class="p">,</span> <span class="m">2011</span><span class="p">,</span> <span class="m">2012</span><span class="p">,</span> <span class="m">2013</span><span class="p">,</span> <span class="m">2014</span><span class="p">,</span> <span class="m">2015</span><span class="p">,</span> <span class="m">2016</span><span class="p">,</span> <span class="m">2017</span><span class="p">,</span> <span class="m">2018</span><span class="p">,</span> <span class="m">20</span>…
<span class="o">$</span> <span class="n">SampledMeans</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">1000</span> <span class="n">x</span> <span class="m">1</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">1000</span> <span class="n">x</span> <span class="m">1</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tbl_df</span><span class="p">[</span><span class="m">1000</span> <span class="n">x</span>…
<span class="o">$</span> <span class="n">Mean</span>         <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span> <span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="m">97675</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span><span class="m">0463</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span><span class="m">65216</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span><span class="m">38878</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span><span class="m">04548</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span><span class="m">73</span>…
</pre></div>
</div>
</div>
</div>
<p>For plotting we can unstack the <code class="docutils literal notranslate"><span class="pre">SampledMeans</span></code>-dataframe.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-24-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-24-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-24-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_yearly_means_distribution</span> <span class="o">=</span> <span class="n">bootstrapped_yearly_means</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">bootstrapped_yearly_means_distribution</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

        <span class="n">Year</span>    <span class="n">SampledMeans</span>
<span class="mi">0</span>       <span class="mf">2010.0</span>  <span class="mf">12.55</span>
<span class="mi">1</span>       <span class="mf">2010.0</span>  <span class="mf">12.83</span>
<span class="mi">2</span>       <span class="mf">2010.0</span>  <span class="mf">14.01</span>
<span class="mi">3</span>       <span class="mf">2010.0</span>  <span class="mf">12.28</span>
<span class="mi">4</span>       <span class="mf">2010.0</span>  <span class="mf">12.86</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-24-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrapped_yearly_means_distribution</span> <span class="o">&lt;-</span> <span class="n">bootstrapped_yearly_means</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">Mean</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">unnest</span><span class="p">()</span>

<span class="nf">head</span><span class="p">(</span><span class="n">bootstrapped_yearly_means_distribution</span><span class="p">)</span>

<span class="n">Year</span>    <span class="n">SampledMeans</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">93</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">80</span>
<span class="m">2010</span>    <span class="m">13</span><span class="p">,</span><span class="m">20</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">53</span>
<span class="m">2010</span>    <span class="m">12</span><span class="p">,</span><span class="m">95</span>
<span class="m">2010</span>    <span class="m">13</span><span class="p">,</span><span class="m">49</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can plot distributions for the data and for the sample mean.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-25-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-25-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-25-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">real_data</span><span class="p">),</span> <span class="p">(</span><span class="n">year_sampled</span><span class="p">,</span> <span class="n">bootstrapped_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">),</span> <span class="n">bootstrapped_yearly_means_distribution</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)):</span>
    <span class="n">figure</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">real_data</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">bootstrapped_data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]),</span> <span class="n">right</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/file-distributions-2010_python.svg" src="../_images/file-distributions-2010_python.svg" /><img alt="../_images/file-distributions-2011_python.svg" src="../_images/file-distributions-2011_python.svg" /><img alt="../_images/file-distributions-2012_python.svg" src="../_images/file-distributions-2012_python.svg" /><img alt="../_images/file-distributions-2013_python.svg" src="../_images/file-distributions-2013_python.svg" /><img alt="../_images/file-distributions-2014_python.svg" src="../_images/file-distributions-2014_python.svg" /><img alt="../_images/file-distributions-2015_python.svg" src="../_images/file-distributions-2015_python.svg" /><img alt="../_images/file-distributions-2016_python.svg" src="../_images/file-distributions-2016_python.svg" /><img alt="../_images/file-distributions-2017_python.svg" src="../_images/file-distributions-2017_python.svg" /><img alt="../_images/file-distributions-2018_python.svg" src="../_images/file-distributions-2018_python.svg" /><img alt="../_images/file-distributions-2019_python.svg" src="../_images/file-distributions-2019_python.svg" /><img alt="../_images/file-distributions-2020_python.svg" src="../_images/file-distributions-2020_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-25-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">8</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>

<span class="n">x_limits</span> <span class="o">&lt;-</span> <span class="nf">range</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">[[</span><span class="s">&#39;BytesLog2&#39;</span><span class="p">]])))</span>

<span class="n">yearly_bytes_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">BytesLog2</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&#39;identity&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ylab</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlab</span><span class="p">(</span><span class="s">&#39;Bytes (log2)&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;Yearly files&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nf">vars</span><span class="p">(</span><span class="n">Year</span><span class="p">))</span>

<span class="n">bootstrapped_yearly_means_distribution</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">SampledMeans</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ylab</span><span class="p">(</span><span class="s">&#39;Number of bootstrapped means&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlab</span><span class="p">(</span><span class="s">&#39;Mean of Bytes (log2)&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlim</span><span class="p">(</span><span class="n">x_limits</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;Distribution of means&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nf">vars</span><span class="p">(</span><span class="n">Year</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/yearly-file-distributions_r.svg" src="../_images/yearly-file-distributions_r.svg" /><img alt="../_images/yearly-mean-distributions_r.svg" src="../_images/yearly-mean-distributions_r.svg" /></div>
</div>
<p>Let’s use our new functions for monthly data as well:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-26-0 docutils container">
<div class="docutils container">
<p>Python</p>
</div>
</div>
<div class="item sphinx-data-tab-26-1 docutils container">
<div class="docutils container">
<p>R</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-26-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_bytes_sum</span> <span class="o">=</span> <span class="n">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceUsage&#39;</span><span class="p">],</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">bootstrapped_monthly_means</span> <span class="o">=</span> <span class="n">bootstrap_byteslog2_mean</span><span class="p">(</span><span class="n">monthly_bytes_sum</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">bootstrapped_monthly_means_distribution</span> <span class="o">=</span> <span class="n">bootstrapped_monthly_means</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">bootstrapped_monthly_means_distribution</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">real_data</span><span class="p">),</span> <span class="p">(</span><span class="n">month_sampled</span><span class="p">,</span> <span class="n">bootstrapped_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">monthly_bytes_sum</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">),</span> <span class="n">bootstrapped_monthly_means_distribution</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)):</span>
    <span class="n">figure</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Files&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">real_data</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;SampledMeans&#39;</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">bootstrapped_data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]),</span> <span class="n">right</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">yearly_bytes_sum</span><span class="p">[</span><span class="s1">&#39;BytesLog2&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/file-distributions-January_python.svg" src="../_images/file-distributions-January_python.svg" /><img alt="../_images/file-distributions-February_python.svg" src="../_images/file-distributions-February_python.svg" /><img alt="../_images/file-distributions-March_python.svg" src="../_images/file-distributions-March_python.svg" /><img alt="../_images/file-distributions-April_python.svg" src="../_images/file-distributions-April_python.svg" /><img alt="../_images/file-distributions-May_python.svg" src="../_images/file-distributions-May_python.svg" /><img alt="../_images/file-distributions-June_python.svg" src="../_images/file-distributions-June_python.svg" /><img alt="../_images/file-distributions-July_python.svg" src="../_images/file-distributions-July_python.svg" /><img alt="../_images/file-distributions-August_python.svg" src="../_images/file-distributions-August_python.svg" /><img alt="../_images/file-distributions-September_python.svg" src="../_images/file-distributions-September_python.svg" /><img alt="../_images/file-distributions-October_python.svg" src="../_images/file-distributions-October_python.svg" /><img alt="../_images/file-distributions-November_python.svg" src="../_images/file-distributions-November_python.svg" /><img alt="../_images/file-distributions-December_python.svg" src="../_images/file-distributions-December_python.svg" /></div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-26-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_bytes_sum</span> <span class="o">&lt;-</span> <span class="nf">aggregate_filesize_data</span><span class="p">(</span><span class="n">filesizes</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Month&#39;</span><span class="p">,</span><span class="s">&#39;BytesLog2&#39;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="s">&#39;SpaceUsage&#39;</span><span class="p">),</span> <span class="n">sum</span><span class="p">)</span>
<span class="n">bootstrapped_monthly_means</span> <span class="o">=</span> <span class="nf">bootstrap_byteslog2_mean</span><span class="p">(</span><span class="n">monthly_bytes_sum</span><span class="p">,</span> <span class="s">&#39;Month&#39;</span><span class="p">,</span> <span class="s">&#39;Files&#39;</span><span class="p">,</span> <span class="n">n_means</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="n">bootstrapped_monthly_means_distribution</span> <span class="o">&lt;-</span> <span class="n">bootstrapped_monthly_means</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">Mean</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">unnest</span><span class="p">()</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>

<span class="n">x_limits</span> <span class="o">&lt;-</span> <span class="nf">range</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">monthly_bytes_sum</span><span class="p">[[</span><span class="s">&#39;BytesLog2&#39;</span><span class="p">]])))</span>

<span class="n">monthly_bytes_sum</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">BytesLog2</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">Files</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Month</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&#39;identity&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ylab</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlab</span><span class="p">(</span><span class="s">&#39;Bytes (log2)&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;Yearly files&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nf">vars</span><span class="p">(</span><span class="n">Month</span><span class="p">))</span>

<span class="n">bootstrapped_monthly_means_distribution</span> <span class="o">%&gt;%</span>
    <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">SampledMeans</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Month</span><span class="p">))</span> <span class="o">+</span>
        <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ylab</span><span class="p">(</span><span class="s">&#39;Number of bootstrapped means&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlab</span><span class="p">(</span><span class="s">&#39;Mean of Bytes (log2)&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">xlim</span><span class="p">(</span><span class="n">x_limits</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;Distribution of means&#39;</span><span class="p">)</span> <span class="o">+</span>
        <span class="nf">facet_grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nf">vars</span><span class="p">(</span><span class="n">Month</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/monthly-file-distributions_r.svg" src="../_images/monthly-file-distributions_r.svg" /><img alt="../_images/monthly-mean-distributions_r.svg" src="../_images/monthly-mean-distributions_r.svg" /></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../chapter-4-scaling/" class="btn btn-neutral float-right" title="Chapter 4: Scaling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../chapter-2-data/" class="btn btn-neutral float-left" title="Chapter 2: Data preparation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Aalto SciComp

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>